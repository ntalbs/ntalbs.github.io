<!DOCTYPE html><html><head><meta name="google-site-verification" content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE"><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Hexo: 3.0 업그레이드 | ntalbs&#39; stuff</title><meta name="description" content=""><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="ntalbs' stuff"></head><body class="home-template"><nav class="navbar" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#nav-items">+</button> <a class="navbar-brand" href="/">@ntalbs' stuff</a></div><div class="navbar-items collapsed" id="nav-items"><ul><li><a href="/archives">Archives</a></li><li><a href="/tags">Tags</a></li><li><a href="/about">About</a></li></ul></div></div></nav><div id="progress"><div id="bar"></div><div class="container"><div id="scroll-title">Hexo: 3.0 업그레이드</div></div></div><header class="site-head"><div class="container"><p class="blog-description">내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p></div></header><main class="container" role="main"><article class="post"><header><p class="post-meta"><time datetime="2015-03-24T00:00:00.000Z" itemprop="datePublished">2015-03-24</time> on <a href="/tags/Hexo/">Hexo</a><a href="/tags/오픈소스/">오픈소스</a></p><h1 class="post-title">Hexo: 3.0 업그레이드</h1></header><section class="post-content"><p>정적 사이트 생성기로 <a href="http://hexo.io" target="_blank" rel="noopener">Hexo</a>를 사용하고 있는데, 최근 버전 3.0이 나왔다. 사용하는 소프트웨어를 항상 최신 버전으로 유지하고자 하는 마음 때문에 업그레이드 했는데, 블로그가 아예 뜨지도 않는 난감한 상황이 발생했다. 온갖 삽질 끝에 블로그를 제대로 뜨게 하는 데 며칠이나 허비했다. <a href="https://github.com/hexojs/hexo/wiki/Breaking-Changes-in-Hexo-3.0" target="_blank" rel="noopener">Breaking Changes in Hexo 3.0</a>에서의 Breaking이 기존 것을 다 깨먹는다는 뜻이었나 싶을 정도였다.<a id="more"></a></p><h2 id="Hexo-math-문제"><a href="#Hexo-math-문제" class="headerlink" title="Hexo-math 문제"></a>Hexo-math 문제</h2><p>업그레이드 후 제일 먼저 발생한 문제는 수식을 렌더링 해주는 <a href="https://github.com/akfish/hexo-math" target="_blank" rel="noopener">hexo-math</a>가 제대로 동작하지 않는 것이었다. 블로그에서 수식을 사용하는 글이 적지 않았기 때문에 당황스러웠다. hexo-math가 Hexo 3.0 업그레이드에 제대로 대응하지 않은 것 같았다. 이것 저것 해보다 잘 안 되어 Hexo를 다시 예전 버전으로 되돌리고 싶었지만, 그것도 쉽지 않았다. 예전에 Hexo 2.8.3으로 업그레이드할 때도 Hexo에서 사용하는 일부 서브모듈이 동작하지 않아 서브모듈 버전까지 낮은 버전으로 맞춰준 적이 있었는데, 그 모듈이 무엇이었는지, 버전이 몇이었는지 생각나지 않았다. 인터넷에서 검색해 찾아보았지만 다시 찾을 수 없었다. 결국 이 문제를 해결하지 않으면 안 되었다.</p><h2 id="대안-플러그인-검토"><a href="#대안-플러그인-검토" class="headerlink" title="대안 플러그인 검토"></a>대안 플러그인 검토</h2><p>혹시 다른 플러그인이 있다 찾아보니 <a href="https://github.com/phoenixcw/hexo-renderer-mathjax" target="_blank" rel="noopener">hexo-renderer-mathjax</a>가 보여 테스트해봤다. 그러나 이 역시 Hexo 3.0에서는 제대로 동작하지 않았다. hexo-renderer-mathjax의 문제는 찾기 쉬웠다. 소스 파일은 <code>index.js</code> 하나 뿐이었고 그나마도 몇 줄 되지 않았다. <code>index.js</code> 파일에서 <code>hexo.file</code>을 참조하는 부분이 있었는데 이 부분이 문제였다. Hexo 3.0에서 모듈 구조가 변경되면서 이 부분이 서브모듈로 떨어져 나갔는데, <code>hexo.file</code>이라고 되어 있는 부분을 <code>require(&#39;hexo-fs&#39;)</code>로 바꾸어 간단히 해결할 수 있었다.</p><p>하지만 안타깝게도 hexo-renderer-mathjax는 사용할 수 없었다. 내 블로그에서는 여러 줄의 수식을 사용하는 글이 꽤 있는데 hexo-renderer-mathjax는 이를 제대로 표현하지 못했다. 할 수 없이 hexo-math의 문제를 해결해야 했다.</p><h2 id="Hexo-math-문제-해결"><a href="#Hexo-math-문제-해결" class="headerlink" title="Hexo-math 문제 해결"></a>Hexo-math 문제 해결</h2><p>hexo-math는 CoffeeScript로 작성되었다. node.js도 모르고 CoffeeScript도 모르고 Hexo 플러그인 구조도 잘 모르지만 JavaScript를 조금 아니 해결을 시도해볼 수 있었다. CoffeeScript로 생성한 JavaScript 코드는 읽을 만 했다. 예외 발생 부분을 보니 역시 hexo-renderer-mathjax와 같은 문제였다. 예전에 <code>hexo.file</code>, <code>hexo.util</code>로 쓰던 부분을 <code>require &#39;hexo-fs&#39;</code>, <code>require &#39;hexo-util&#39;</code>로 수정하니 해당 부분에서 예외가 발생하지 않았다. <code>Command.coffee</code>에서 <code>hexo.theme_dir</code>을 참조하는 부분은 해결하지 못했다. Hexo 3.0에서는 여기로 <code>hexo</code> 객체가 넘어오지 않았다. 이 부분은 어쩔 수 없이 하드코딩으로 해결했다.</p><p>여러 줄의 수식을 써야 하는 경우 예전에는 마크다운 파일에서 <code>{% math-block %} ... {% endmath-block %}</code>을 사용했는데, 이 부분도 문제가 되었다. 중간에 <code>-</code>가 들어간 부분이 제대로 처리되지 않는 것 같았다. Swig 문서를 찾아보니 수식 블록을 <code>{% block math %} ... {% endblock %}</code>으로 써도 될 것 같았다. 수정해 확인해보니 에러는 발생하지 않지만 한 파일에 여러 수식 블록이 있는 경우 모든 수식 블록이 마지막 수식으로 표시되는 문제가 있었다. 저자가 설명한 대로 <code>{% math_block %} ... {% endmath_block %}</code>를 사용하도록 문서를 업데이트했다.</p><h2 id="테마-수정"><a href="#테마-수정" class="headerlink" title="테마 수정"></a>테마 수정</h2><p>다시 <code>hexo server</code> 명령으로 블로그를 띄워보니 에러 없이 잘 표시되는 것 같았다. 그런데 Archive 페이지에 가보니 글이 다섯 개만 표시되는 것이었다. Tags 페이지는 예외가 발생해 아예 표시되지도 않았다. Hexo 3.0으로 넘어가면서 내부에서 사용하는 객체 구조도 바뀐 모양이다. <a href="http://hexo.io/api/locals.html" target="_blank" rel="noopener">Local Variables 문서</a>를 참조하고 변수 값을 <code>console.log</code>로 찍어가며 디버깅해 제대로 나오도록 ejs 파일을 수정했다.</p><ul><li><code>archive.ejs</code>: <code>_config.yml</code>에서 한 페이지당 5개 글이 나오도록 설정되어 있다. 예전에는 Archives 페이지에 대한 페이징 설정이 따로 있었는데 Hexo 3.0에서는 해당 설정이 사용되지 않고 Archives 페이지에서도 목록에 글이 5개만 표시되는 문제가 있다. 나는 Archives 페이지에서 페이지 처리를 하지 않을 것이므로 <code>page.posts</code>를 쓰던 부분을 <code>site.posts</code>로 수정해 문제를 해결했다.</li><li><code>tags.ejs</code>: <code>post.tags._index.indexOf(...)</code>를 사용해 현재 태그와 포스트의 태그가 같은지 확인하는 부분이 있는데, Hexo 3.0에서는 <code>post.tags._index</code>가 <code>undefined</code>로 넘어온다. 이 부분도 오류가 발생하지 않도록 코드를 수정해야 했다.</li><li><code>tag.ejs</code> 추가: <code>archive.ejs</code>에서 <code>page.posts</code> 대신 <code>site.posts</code>를 쓰게 했더니 블로그에서 태그 클릭 시 태그에 해당하는 글 목록만 표시되는 게 아니라 계속 전체 글 목록이 표시되었다. 태그를 클릭했을 때도 실제로는 <code>archive.ejs</code>가 해당 페이지를 렌더링하게 되어 있어 그랬다. 태그별로 별도 페이지가 생기도록 하기 위해 <code>tag.ejs</code>를 추가했다.</li></ul><p>일단 블로그를 제대로 생성할 수 있게 만드는 것이 급선무였기 때문에 일단 돌아가게 만드는 데 주력했다. 올바르게 수정한 것인지는 모르겠다.</p><h2 id="소스-코드-하이라이트"><a href="#소스-코드-하이라이트" class="headerlink" title="소스 코드 하이라이트"></a>소스 코드 하이라이트</h2><p>이제 다 됐겠지 하고 살펴보니 코드 블록의 문법 강조가 제대로 표시되지 않은 게 보였다. 이 부분은 <a href="https://highlightjs.org/" target="_blank" rel="noopener">highlight.js</a>에 맞춰 Hexo의 소스코드를 직접 수정해 사용하던 부분이었는데, Hexo 3.0에서는 관련 부분이 어디인지 찾을 수 없었다. 할 수 없이 CSS 파일을 수정했다. 다행히 클래스 이름 앞에 붙어있던 <code>hljs</code> 접두사를 제거하니 해결되었다.</p><h2 id="정리"><a href="#정리" class="headerlink" title="정리"></a>정리</h2><p>Hexo 작성자를 비난하려는 의도는 없다. Hexo는 node.js 기반의 정적 사이트 생성기로 블로그를 다시 시작할 때 많은 고민과 검토 끝에 선택한 도구다. node.js 기반의 도구 중에 문서화가 가장 잘 되어 있었고 개발도 가장 활발하게 진행되고 있었다. 업데이트 할 때 호환성 때문에 생긴 약간의 문제(사실 이번에는 조금 컸지만)를 제외하면 매우 만족스럽게 사용하고 있다. 작성자가 하위 호환성이나 안정성에 신경을 덜 쓰는 게 아닌가 하는 생각이 든다. 이번 Hexo 3.0에서도 내부적으로는 리팩터링도 하고 모듈 구조도 변경해 많은 것이 바뀌었지다지만, 최종 사용자 입장에서는 아직까지 크게 바뀐 점을 모르겠다. 앞으로는 Hexo를 업데이트를 할 때 이번처럼 무작정 하기보다는 롤백을 염두에 두고 조심해 작업해야 겠다는 생각이 든다.</p><h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul><li><a href="https://github.com/hexojs/hexo/wiki/Breaking-Changes-in-Hexo-3.0" target="_blank" rel="noopener">Breaking Changes in Hexo 3.0</a></li><li><a href="http://hexo.io/api/locals.html" target="_blank" rel="noopener">Hexo: Local Variables</a></li><li><a href="https://github.com/akfish/hexo-math/pull/4" target="_blank" rel="noopener">hexo-math 수정 부분 Pull Request</a><br><code>hexo.theme_dir</code> 부분은 해결하지 못해 저자에게 잘 해결해달라고 부탁했다.</li><li><a href="https://github.com/phoenixcw/hexo-renderer-mathjax/pull/2" target="_blank" rel="noopener">hexo-renderer-mathjax 수정 부분 Pull Request</a></li><li><a href="/2014/hexo-hljs/">Hexo: 소스 코드 하이라이팅 스타일 변경</a><br>이때 정리했던 내용은 더 이상 유효하지 않지만, 이때 배운 지식을 바탕으로 이번 문제를 해결할 수 있었다.</li></ul><div class="button-box"><a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a> <a class="twitter-follow-button" href="https://twitter.com/ntalbs" data-show-count="false">Follow @ntalbs</a></div></section><footer class="post-footer"><nav id="article-nav"><a href="/2015/emacs-find-replace-on-multiple-files/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title">Emacs: 여러 파일 안의 텍스트 찾기/바꾸기</span> </a><a href="/2015/project-euler-013/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">프로젝트 오일러 13</span></a></nav><section id="comment"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></footer></article></main><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><footer class="site-footer"><div class="inner"><section class="copyright">&copy; 2008-2018 <a href="/about">ntalbs</a></section><section class="poweredby">Powered by <a class="icon-ghost" href="http://hexo.io">Hexo</a></section></div></footer><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script type="text/javascript" src="/js/jquery.fitvids.js"></script><script type="text/javascript" src="/js/index.js"></script><script>!function(e,a,t,n,c,s,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,s=a.createElement(t),o=a.getElementsByTagName(t)[0],s.async=1,s.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(s,o)}(window,document,"script",0,"ga"),ga("create","UA-2098194-3","auto"),ga("require","displayfeatures"),ga("send","pageview")</script><script type="text/javascript">var disqus_shortname="ntalbs-stuff";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config("");</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>