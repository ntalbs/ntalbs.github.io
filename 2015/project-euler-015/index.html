<!DOCTYPE html>
<html>
  <head>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-2098194-3"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-2098194-3');
</script>
<meta charset="UTF-8">

<meta name="google-site-verification" content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE" />

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>프로젝트 오일러 15 @ntalbs&#39; stuff</title>
<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="stylesheet" href="/css/style.css">

  </head>
  <body>
    <div id="progress">
  <div id="bar"></div>
  <div class="container">
    <div id="scroll-title">프로젝트 오일러 15</div>
  </div>
</div>

    <nav class="navbar" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#nav-items">+</button>
      <a class="navbar-brand" href="/">@ntalbs&#39; stuff</a>
    </div>
    <div class="navbar-items collapsed" id="nav-items">
      <ul>
        
        <li><a href="/archive/">Archive</a></li>
        
        <li><a href="/tags/">Tags</a></li>
        
        <li><a href="/about/">About</a></li>
        
      </ul>
    </div>
  </div>
</nav>

<header class="page-head">
  <div class="container">
    <p class="blog-description">내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p>
  </div>
</header>

    <main class="container" role="main">
      <article class="post">
        <header>
          <p class="post-meta">
            <time datetime="2015-04-06" itemprop="datePublished">2015-04-06</time>
            on
            
            <a href="/tags/project-euler/">Project-Euler</a>
            
            <a href="/tags/clojure/">Clojure</a>
            
          </p>
          <h1 class="post-title">
            프로젝트 오일러 15
          </h1>
        </header>
        <section class="post-content">
          <blockquote>
<p>20×20 격자의 좌상단에서 우하단으로 가는 경로의 수?</p>

<p>문제 자세히 보기: <a href="http://euler.synap.co.kr/prob_detail.php?id=15">[국어]</a> <a href="https://projecteuler.net/problem=15">[영어]</a></p>
</blockquote>

<p><img src="https://projecteuler.net/project/images/p015.gif" alt="" /></p>

<p>격자에서 오른쪽으로 이동하는 경로를 <code>r</code>(right), 아래쪽으로 이동하는 경로를 <code>d</code>(down)라 하면 2x2 격자의 좌상단에서 우하단으로 가는 경로는 다음과 같은 식으로 표현할 수 있다.</p>

<pre><code>rrdd, rdrd, rddr
drrd, drdr, ddrr
</code></pre>

<p>결국 이 문제는 <code>rrdd</code>에 대한 순열을 구하는 문제가 된다. <code>r</code> 끼리 또는 <code>d</code>끼리는 순서가 바뀌어도 상관이 없다. 따라서 2x2 격자의 좌상단에서 우하단으로 가는 경로의 수는 다음과 같이 구할 수 있다.</p>

<div>$$
\begin{aligned}
  \begin{aligned}
    (number\, of\, paths) &= \frac{4!}{2! \times 2!} = 6
  \end{aligned}
\end{aligned}
$$</div>

<p>20x20 격자라면 <code>r</code> 20개, <code>d</code> 20개를 일렬로 늘어놓을 수 있는 경우의 수를 구하는 문제가 된다. 따라서 다음 식을 계산하면 문제의 답을 구할 수 있다.</p>

<div>$$
\begin{aligned}
  \begin{aligned}
    (number\, of\, paths) &= \frac{40!}{20! \times 20!}
  \end{aligned}
\end{aligned}
$$</div>

<p><code>n!</code>을 구하는 함수가 있다면 답을 구한 것이나 마찬가지다. <code>factorial</code>이 구현되어 있다고 한다면 답은 다음과 같이 구할 수 있다.</p>

<pre><code class="language-clojure">(defn solve []
  (let [f40 (factorial 40) f20 (factorial 20)]
    (/ f40 (*' f20 f20))))
</code></pre>

<p>결과는 다음과 같다.</p>

<pre class="console">
p015=> (time (solve))
"Elapsed time: 0.16456 msecs"
13784652????N
</pre>

<p>문제 풀이에 대해서는 더 이상 설명할 것이 없으므로, Factorial 함수를 구현하는 방법에 대해 정리해보려 한다.</p>

<h2 id="factorial-함수-구현">Factorial 함수 구현</h2>

<p>Factorial은 보통 다음과 같이 재귀적으로 정의된다.</p>

<div>$$
\begin{aligned}
n! = \begin{cases}
  1 & \mbox{if } n = 0, \cr
  n(n-1)! & \mbox {if } n > 0
  \end{cases}
\end{aligned}
$$</div>

<p>Clojure 코드로는 다음과 같이 구현할 수 있다.</p>

<pre><code class="language-clojure">(defn fact1 [n]
  (if (= 0 n)
    1
    (*' n (fact1 (dec n)))))
</code></pre>

<p><code>factorial</code>은 매우 빠르게 커지는 함수로 $21!$만 되어도 <code>Long</code>의 표현 범위를 넘는다. 범위에 관계 없이 <code>factorial</code>을 구할 수 있도록 <code>*'</code>을 이용해 곱셈을 구했다. 그러나 이렇게 작성하면 매 재귀호출 때마다 스택을 소비하므로 큰 수의 Factorial을 구할 때는 <code>StackOverflowError</code>가 발생할 수 있다.</p>

<pre class="console">
user=> (fact1 20000)

StackOverflowError   clojure.lang.Util.equiv (Util.java:30)
</pre>

<p>꼬리재귀(Tail Recursion)을 사용하면 <code>StackOverflowError</code>를 피할 수 있다. Clojure에서 꼬리재귀를 사용하려면 <code>recur</code> Special Form을 사용해야 한다. <code>recur</code>는 tail position에서만 사용할 수 있는데, 위 <code>factorial</code> 구현에서 재귀호출하는 부분은 tail position이 아니다. 따라서 꼬리재귀를 사용하려면 다음과 같이 보조 함수를 도입해 함수 형태를 변경할 수 있다.</p>

<pre><code class="language-clojure">(defn fact-helper [n acc]
  (if (= 0 n)
    acc
    (recur (dec n) (*' n acc))))

(defn fact2 [n]
  (fact-helper n 1))
</code></pre>

<p>이렇게 하면 큰 수에 대해서도 <code>StackOverflowError</code>가 발생하지 않고 잘 동작한다.</p>

<pre class="console">
user=> (factorial 20000)
18192063202303451348276417568...
</pre>

<p>그러나 <code>fact-helper</code>와 같은 보조 함수가 <code>factorial</code> 밖에서 보이는 게 불만이다. <code>letfn</code>을 사용하면 보조 함수를 <code>factorial</code> 함수 안으로 숨길 수 있다.</p>

<pre><code class="language-clojure">(defn fact3 [n]
  (letfn [(f [n acc]
            (if (= 0 n)
              acc
              (recur (dec n) (* n acc))))]
    (f n 1)))
</code></pre>

<p>또는 <code>loop</code>를 사용할 수도 있다.</p>

<pre><code class="language-clojure">(defn fact4 [n]
  (loop [n n, acc 1]
    (if (= 0 n)
      acc
      (recur (dec n) (*' n acc)))))
</code></pre>

<p>Factorial 함수는 0 또는 양의 정수에 대해서만 유효하다. <code>fact1</code>의 경우 인자가 음수일 경우 <code>StackOverflowError</code>가 발생할 것이고, <code>fact2</code>, <code>fact3</code>, <code>fact4</code>는 무한루프에 빠질 것이다. 따라서 다음과 같이 선행조건(precondition)을 추가할 수 있다.</p>

<pre><code class="language-clojure">(defn fact4 [n]
  {:pre [(or (pos? n) (zero? n)) (integer? n)]}
  ...
</code></pre>

<p>Factorial을 다음과 같이 정의할 수도 있다.</p>

<div>$$
\begin{aligned}
  n! = \prod_{k=1}^n k = 1 \times 2\, \times ... \times\, n
\end{aligned}
$$</div>

<p>이 정의를 그대로 Clojure 코드로 옮기면 다음과 같다.</p>

<pre><code class="language-clojure">(defn factorial [n]
  (apply *' (range 1 (inc n))))
</code></pre>

<p><code>apply</code> 대신 <code>reduce</code>를 사용할 수도 있다.</p>

<p>이 구현이 0에 대해서도 유효할까?</p>

<pre class="console">
user=> (factorial 0)
1
</pre>

<p>특별히 해준 것도 없는데 0을 입력했을 때 결과가 제대로 나오는 이유는 <code>*'</code> 함수(<code>*</code>도 마찬가지)에 있다. <code>*'</code> 함수는 인자가 없는 경우 1을 리턴하도록 되어 있다. 위 <code>factorial</code> 함수에 0을 입력한 경우 <code>(range 1 (inc 0))</code>은 <code>()</code> 즉 빈 리스트가 될 테고 빈 리스트에 <code>*'</code>를 <code>apply</code>하면 <code>*'</code>의 정의에 따라 1이 리턴된다. 인자가 없는 경우 <code>*'</code>가 1을 리턴하도록 한 이유는 1이 곱셈에 대한 항등원이기 때문일 것이다. <code>+'</code> 함수(<code>+</code>도 마찬가지)의 경우는 인자가 주어지지 않으면 0을 리턴하는데 이 또한 0이 덧셈에 대한 항등원이기 때문일 것이다.</p>

<h2 id="참고">참고</h2>

<ul>
<li><a href="http://en.wikipedia.org/wiki/Factorial">Factorial</a></li>
<li><a href="http://betterexplained.com/articles/navigate-a-grid-using-combinations-and-permutations/">Navigate a Grid Using Combinations And Permutations</a></li>
<li><a href="https://github.com/ntalbs/euler/blob/master/src/p015.clj">프로젝트 오일러 15 풀이 소스 코드</a></li>
</ul>
        </section>
        <footer class="post-footer">
          
          <div class="social button-box">
            
            <a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a>
            <a class="twitter-follow-button" href="https://twitter.com/ntalbs" data-show-count="false">Follow @ntalbs</a>
            <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
            
          </div>
          
          <nav id="article-nav">
            
            <a class="article-nav-link-wrap previous" href="https://ntalbs.github.io/2015/statement-expresssion/" id="article-nav-newer"> statement와 expression</a>
            
            
            <a class="article-nav-link-wrap next" href="https://ntalbs.github.io/2015/project-euler-014/" id="article-nav-older"> 프로젝트 오일러 14</a>
            
          </nav>
        </footer>
      </article>
    </main>
    
<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
    <script type="text/javascript">
     var disqus_shortname = 'ntalbs-stuff';
     (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


    <section class="section">
  <div class="container has-text-centered">
    <p></p>
  </div>
</section>
<script src=https://ntalbs.github.io/js/index.js type="text/javascript"></script>

    <link rel="stylesheet" href="/css/github.css">
<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
   tex2jax: {
     inlineMath: [['$','$']],
     displayMath: [['$$','$$']],
     processEscapes: true,
     processEnvironments: true,
     skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
     TeX: { equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "AMSsymbols.js"] }
   }
 });
</script>

    <footer class="page-bottom">
  <div class="inner">
    <section class="copyright">© 2008-2018 <a href="/about">ntalbs</a></section>
    <section class="poweredby">Powered by <a class="icon-ghost" href="https://gohugo.io">Hugo</a></section>
  </div>
</footer>

  </body>
</html>
