<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>프로젝트 오일러 35 @ntalbs&#39; stuff</title>
<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/github.css">

  </head>
  <body>
    <div id="progress">
  <div id="bar"></div>
  <div class="container">
    <div id="scroll-title">프로젝트 오일러 35</div>
  </div>
</div>

    <nav class="navbar" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#nav-items">+</button>
      <a class="navbar-brand" href="/">@ntalbs&#39; stuff</a>
    </div>
    <div class="navbar-items collapsed" id="nav-items">
      <ul>
        
        <li><a href="/archive/">Archive</a></li>
        
        <li><a href="/tags/">Tags</a></li>
        
        <li><a href="/about/">About</a></li>
        
      </ul>
    </div>
  </div>
</nav>

<header class="page-head">
  <div class="container">
    <p class="blog-description">내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p>
  </div>
</header>

    <main class="container" role="main">
      <article class="post">
        <header>
          <p class="post-meta">
            <time datetime="2015-10-06" itemprop="datePublished">2015-10-06</time>
            on
            
            <a href="/tags/project-euler/">Project-Euler</a>
            
            <a href="/tags/clojure/">Clojure</a>
            
          </p>
          <h1 class="post-title">
            프로젝트 오일러 35
          </h1>
        </header>
        <section class="post-content">
          <blockquote>
<p>백만 이하인 circular prime 개수 구하기</p>

<p>문제 자세히 보기: <a href="http://euler.synap.co.kr/prob_detail.php?id=35">[국어]</a> <a href="https://projecteuler.net/problem=35">[영어]</a></p>
</blockquote>

<p>백만 이하의 소수는 <code>clojure.contrib.lazy-seqs</code>의 <code>primes</code>를 이용해 구할 수 있다. <code>digits</code>를 이용해 숫자의 시퀀스를 만들고 <code>cycle</code>과 <code>partition</code>을 이용하면 순환수(circular number)도 쉽게 구할 수 있다.</p>

<pre><code class="language-clojure">(ns p035
  (:require [clojure.contrib.lazy-seqs :refer [primes]]
            [util :refer [parse-int digits prime?]]))

(defn circular-nums [n]
  (let [ds (digits n) len (count ds)]
    (-&gt;&gt; (cycle ds)
         (partition len 1)
         (take len)
         (map #(parse-int (apply str %))))))
</code></pre>

<p><code>circular-nums</code>는 순환수 리스트를 리턴한다. 리스트에 포함된 모든 수가 소수인지를 판별하는 함수는 다음과 같이 작성할 수 있다.</p>

<pre><code class="language-clojure">(defn all-prime? [coll]
  (every? prime? coll))
</code></pre>

<p>이 두 함수를 이용하면 문제는 다음과 같이 간단히 풀 수 있다.</p>

<pre><code class="language-clojure">(defn solve0 []
  (-&gt;&gt; primes
       (take-while #(&lt; % 1000000))
       (filter (fn [n] (all-prime? (circular-nums n))))
       count))
</code></pre>

<p>다만 실행 속도가 썩 만족스럽지는 않다.</p>

<pre class="console">p035=> (time (solve0))
"Elapsed time: 1630.826804 msecs"
5?
</pre>

<h2 id="개선-1">개선 1</h2>

<p>위 풀이는 비효율적인 부분이 있다. 순환수의 리스트를 만들기 위해 <code>digits</code>, <code>cycle</code>, <code>partition</code> 등을 사용하는 것도 무거워 보인다. 순환수를 만들다 하나라도 소수가 아닌 수를 만나면 바로 <code>false</code>를 리턴하는 방식이 아니라 일단 주어진 수에 대해 모든 순환수를 미리 만들어 놓는 부분도 개선할 수 있을 것 같다.</p>

<p>위에서와 같이 한꺼번에 순환수의 리스트를 구하는 대신 주어진 수의 다음 단계 순환수만 만드는 함수를 작성한 다음 필요한 만큼만 호출하면 좀더 효율적일 것 같다. 따라서 다음과 같이 한 단계만 순환시키는 함수를 만들어보자.</p>

<pre><code class="language-clojure">(ns p035
  (:require [clojure.contrib.lazy-seqs :refer [primes]]
            [util :refer [parse-int digits prime? pow]])) ; pow 추가

(defn- cycle1 [n p]
  (let [i (quot n 10) l (rem n 10)]
    (+ (* l (pow 10 p)) i)))
</code></pre>

<p>이 구현에서는 <code>digit</code>, <code>cycle</code>, <code>partition</code>을 사용하지 않기 때문에 내부적으로 중간 단계 시퀀스를 생성하지 않으므로 <code>circular-nums</code>보다 훨씬 가볍다 할 수 있다. <code>pow</code>를 호출할 때의 지수 <code>p</code>는 <code>Math/log10</code> 함수로 값을 구할 수 있지만, 동일한 자릿수의 숫자에 대해 반복적으로 구하는 것을 회피하고자 인자로 받게 했다. 어찌 보면 어설픈 최적화라 할 수도 있겠지만, 뻔히 아는 것을 매번 다시 구하지 않도록 하면 그만큼 더 빨라질 것이다.</p>

<p>이제 <code>circular-prime?</code> 함수를 구현할 차례다. <code>circular-nums</code>를 사용할 때처럼 미리 순환수 리스트를 구한 다음 리스트 안의 모든 수가 소수인지 검사하는 방법 대신, 한 단계씩 순환수를 만들어가며 중간에 소수가 아닌 수가 나오면 바로 <code>false</code>를 리턴하도록 구현했다. 루프를 몇 번 돌지는 주어진 수의 <code>log10</code> 값으로 알 수 있다.</p>

<pre><code class="language-clojure">(defn- circular-prime1? [n]
  (let [p (int (Math/log10 n))]
    (loop [n n, cnt p]
      (cond
        (= 0 cnt) (prime? n)
        (prime? n) (recur (cycle1 n p) (dec cnt))
        :else false))))
</code></pre>

<p><code>cycle1</code>과 <code>circular-prime1?</code> 함수를 이용한 풀이는 다음과 같다.</p>

<pre><code class="language-clojure">(defn solve1 []
  (-&gt;&gt; primes
       (take-while #(&lt; % 1000000))
       (filter circular-prime1?)
       count))
</code></pre>

<p>실행 결과는 다음과 같다. 개선되긴 했지만 아직 충분히 빠르지는 않다.</p>

<pre class="console">p035=> (time (solve1))
"Elapsed time: 1241.998528 msecs"
5?
</pre>

<h2 id="개선-2">개선 2</h2>

<p><strong>개선 1</strong> 풀이에서는 <code>circular-prime1?</code>에 소수만 전달하면서도 그 수가 소수인지 다시 확인하고 있다. <code>prime?</code> 함수에 큰 소수가 입력되면 비용이 많이 든다. 따라서 소수를 <code>prime?</code>으로 확인하는 단계를 제거하면 성능이 향상될 것이다.</p>

<pre><code class="language-clojure">(defn- circular-prime2? [n] ;; 처음 전달된 n은 prime이라고 가정
  (let [p (int (Math/log10 n))]
    (loop [n (cycle1 n p), cnt (dec p)]
      (cond
        (&lt;= cnt 0) (prime? n)
        (prime? n) (recur (cycle1 n p) (dec cnt))
        :else false))))
</code></pre>

<p><code>circular-prime2?</code>는 인자로 전달되는 수가 소수라 가정해 인자가 소수인지 확인하는 단계를 생략했다. 이 함수를 이용한 풀이는 다음과 같다.</p>

<pre><code class="language-clojure">(defn solve2 []
  (-&gt;&gt; primes
       (take-while #(&lt; % 1000000))
       (filter circular-prime2?)
       count))
</code></pre>

<p><code>circular-prime1?</code>을 쓰던 부분을 <code>circular-prime2?</code>로 바꿨을 뿐이다. 실행 결과는 다음과 같다.</p>

<pre class="console">p035=> (time (solve2))
"Elapsed time: 285.24435 msecs"
5?
</pre>

<p>시간이 <strong>개선 1</strong> 풀이의 <sup>1</sup>&frasl;<sub>4</sub> 이하로 단축되었다.</p>

<h2 id="참고">참고</h2>

<ul>
<li><a href="https://github.com/ntalbs/euler/blob/master/src/p035.clj">프로젝트 오일러 35 풀이 소스 코드</a></li>
<li><a href="/2015/project-euler-013/">프로젝트 오일러 13</a>
<code>digits</code> 함수 구현을 확인할 수 있다.</li>
<li><a href="/2015/project-euler-007/">프로젝트 오일러 7</a>
<code>prime?</code> 함수 구현에 대한 설명을 볼 수 있다.</li>
</ul>
        </section>
        <footer class="post-footer">
          
          <div class="social button-box">
            
            <a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a>
            <a class="twitter-follow-button" href="https://twitter.com/ntalbs" data-show-count="false">Follow @ntalbs</a>
            <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
            
          </div>
          
          <nav id="article-nav">
            
            <a class="article-nav-link-wrap previous" href="https://ntalbs.github.io/2015/project-euler-036/" id="article-nav-newer"> 프로젝트 오일러 36</a>
            
            
            <a class="article-nav-link-wrap next" href="https://ntalbs.github.io/2015/project-euler-034/" id="article-nav-older"> 프로젝트 오일러 34</a>
            
          </nav>
        </footer>
      </article>
    </main>
    
<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
    <script type="text/javascript">
     var disqus_shortname = 'ntalbs-stuff';
     (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


    <section class="section">
  <div class="container has-text-centered">
    <p></p>
  </div>
</section>
<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2098194-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script src=https://ntalbs.github.io/js/index.js type="text/javascript"></script>

    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
   tex2jax: {
     inlineMath: [['$','$']],
     displayMath: [['$$','$$']],
     processEscapes: true,
     processEnvironments: true,
     skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
     TeX: { equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "AMSsymbols.js"] }
   }
 });
</script>

    <footer class="page-bottom">
  <div class="inner">
    <section class="copyright">© 2008-2018 <a href="/about">ntalbs</a></section>
    <section class="poweredby">Powered by <a class="icon-ghost" href="https://gohugo.io">Hugo</a></section>
  </div>
</footer>

  </body>
</html>
