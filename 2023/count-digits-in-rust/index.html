<!doctype html><html><head><script src=/js/mode.js type=text/javascript></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3882204692252974" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-2098194-3"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-2098194-3")</script><meta name=google-site-verification content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE"><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jce8mxrx8a")</script><meta charset=UTF-8><meta http-equiv=content-language content="ko-KR"><meta name=description content="Rust에서 제너릭을 사용해 모든 정수 타입에 사용할 수 있는 count_digits 함수 구현"><meta name=keywords content="러스트,count_digits,Rust"><meta property="og:title" content="Rust에서 count_digits 함수 구현 @ntalbs' stuff"><meta property="og:site_name" content="@ntalbs' stuff"><meta property="og:url" content="https://ntalbs.github.io/2023/count-digits-in-rust/"><meta property="og:description" content="Rust에서 제너릭을 사용해 모든 정수 타입에 사용할 수 있는 count_digits 함수 구현"><meta name=og:image content="https://ntalbs.github.io/2023/06-02-count-digits-in-rust/digits.jpeg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@ntalbs"><meta name=twitter:creator content="@ntalbs"><meta name=viewport content="width=device-width,initial-scale=1"><title>Rust에서 count_digits 함수 구현 @ntalbs' stuff</title>
<link rel="shortcut icon" href=/images/favicon.ico><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/highlight.css></head><body><div id=progress><div id=bar></div><div class=container><div id=scroll-title>Rust에서 count_digits 함수 구현</div></div></div><nav class=navbar role=navigation><div class=container><div class=navbar-header><button type=button class="navbar-toggle unselectable" data-toggle=collapse data-target=#nav-items>+</button>
<a class="navbar-brand unselectable" href=/>@ntalbs' stuff</a></div><div class="navbar-items collapsed" id=nav-items><ul><li><input id=search type=search placeholder="Search this site" autocomplete=off></li><li><a class=unselectable href=/archive/>Archive</a></li><li><a class=unselectable href=/tags/>Tags</a></li><li><a class=unselectable href=/about/>About</a></li><li><a id=mode-switch class=unselectable href=#><svg data-bs-theme-value="dark" xmlns="http://www.w3.org/2000/svg" class="icon-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg><svg data-bs-theme-value="light" xmlns="http://www.w3.org/2000/svg" class="icon-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></a></li></ul></div></div></nav><header class=page-head><div class=container><p class=blog-description>내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p></div></header><main class=container role=main><article class=post><header><p class=post-meta><time datetime=2023-06-02 itemprop=datePublished>2023-06-02</time>
on
<a href=/tags/rust/>rust</a></p><h1 class=post-title>Rust에서 count_digits 함수 구현</h1></header><section class=post-content><p><img src=/2023/06-02-count-digits-in-rust/digits.jpeg alt="Feature image"></p><p>Clojure와 같은 동적 언어에서는 숫자 타입을 신경쓰지 않고 간단한 계산 함수를 구현할 수 있는 점이 편리하다. 예를 들어 정수 자릿수를 구하는 함수는 다음과 같이 간단히 구현할 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-clojure data-lang=clojure><span class=line><span class=cl><span class=p>(</span><span class=kd>defn </span><span class=nv>count-digits</span> <span class=p>[</span><span class=nv>n</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>loop </span><span class=p>[</span><span class=nv>n</span> <span class=nv>n</span> <span class=nv>acc</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>&lt; </span><span class=nv>n</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nv>acc</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>recur</span> <span class=p>(</span><span class=nb>quot </span><span class=nv>n</span> <span class=mi>10</span><span class=p>)</span> <span class=p>(</span><span class=nb>inc </span><span class=nv>acc</span><span class=p>)))))</span>
</span></span></code></pre></div><p>Rust와 같은 강타입 언어에서는 이런 융통성을 누릴 수 없다. 같은 함수를 Rust로는 다음과 같이 작성할 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>count_digits</span><span class=p>(</span><span class=k>mut</span><span class=w> </span><span class=n>n</span>: <span class=kt>u32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>u32</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>loop</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>ten</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>count</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>n</span><span class=w> </span><span class=o>/=</span><span class=w> </span><span class=n>ten</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>count</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>그러나 이 구현은 <code>u32</code> 타입에만 쓸 수 있다. Rust에는 이것 말고도 <code>u8</code>, <code>u16</code>, <code>u64</code>, <code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>등 더 많은 정수형 데이터 타입이 있다. Rust에서 모든 정수형 타입에 대해 동작하도록 <code>count_digits</code> 함수를 만들려면 어떻게 해야 할까?</p><p>한 함수가 여러 타입에 동작하도록 하려면 제너릭을 사용해야 한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>count_digits</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=k>mut</span><span class=w> </span><span class=n>n</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>usize</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><code>count_digits</code> 함수는 정수형 데이터 타입에 대해서만 의미가 있다. 타입 파라미터 <code>T</code>에 Rust의 정수형 타입만 쓸 수 있도록 하려면 어떻게 해야 할까?</p><p>Rust에서는 기존 타입에 트레잇을 추가할 수 있다. <code>Int</code>라는 트레잇을 정의한 다음 <code>u8</code>, <code>i16</code> 등의 정수 타입에 <code>Int</code> 트레잇을 구현해 모든 정수 타입에 <code>Int</code>을 추가하고 <code>count_digits</code> 함수를 <code>Int</code> 트레잇을 구현한 모든 타입에 대해 동작하도록 수정할 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=c1>// define Int trait
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>trait</span><span class=w> </span><span class=n>Int</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// implement Int trait for each integral type
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>impl</span><span class=w> </span><span class=n>Int</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=kt>u8</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Int</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=kt>u16</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Int</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=kt>i8</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// now count_digits will work with the type that implements Int trait
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>count_digits</span><span class=o>&lt;</span><span class=n>T</span>:<span class=nc>Int</span><span class=o>&gt;</span><span class=p>(</span><span class=k>mut</span><span class=w> </span><span class=n>n</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>usize</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>각 정수 타입에 <code>Int</code> 트레잇을 구현하는 코드는 매크로로 대체할 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>macro_rules</span><span class=o>!</span><span class=w> </span><span class=n>impl_int_for</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>(</span><span class=w> </span><span class=cp>$(</span><span class=w> </span><span class=cp>$t</span>:<span class=nc>ty</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=cp>$(</span><span class=w> </span><span class=k>impl</span><span class=w> </span><span class=n>Int</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=cp>$t</span><span class=w> </span><span class=p>{}</span><span class=w> </span><span class=p>)</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>이 매크로를 이용하면 다음과 같이 간단히 각 정수 타입이 <code>Int</code> 트레잇을 구현하게 할 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=fm>impl_int_for!</span><span class=p>(</span><span class=kt>u8</span><span class=w> </span><span class=kt>u16</span><span class=w> </span><span class=kt>u32</span><span class=w> </span><span class=kt>u64</span><span class=w> </span><span class=kt>u128</span><span class=w> </span><span class=kt>i8</span><span class=w> </span><span class=kt>i16</span><span class=w> </span><span class=kt>i32</span><span class=w> </span><span class=kt>i64</span><span class=w> </span><span class=kt>i128</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>이제 <code>count_digits</code> 함수 구현을 살펴볼 차례다. <code>count_digits</code>는 입력 받은 숫자가 10으로 몇 번 나눠지는지를 계산한다. 입력 받은 숫자(타입 <code>T</code>)를 10(타입 <code>T</code>)으로 나눌 방법이 필요하다. 따라서 타입 <code>T</code>에 대한 10을 얻을 수 있도록 다음과 같이 <code>Int</code> 트레잇과 <code>impl_int_for!</code> 매크로를 수정한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>trait</span><span class=w> </span><span class=n>Int</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>ten</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>macro_rules</span><span class=o>!</span><span class=w> </span><span class=n>impl_int_for</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>(</span><span class=w> </span><span class=cp>$(</span><span class=w> </span><span class=cp>$t</span>:<span class=nc>ty</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=cp>$(</span><span class=w> </span><span class=k>impl</span><span class=w> </span><span class=n>Int</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=cp>$t</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>fn</span> <span class=nf>ten</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=p>)</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>이제 <code>count_digits</code> 함수는 다음과 같이 수정해야 한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>count_digits</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=k>mut</span><span class=w> </span><span class=n>n</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>usize</span>
</span></span><span class=line><span class=cl><span class=nc>where</span><span class=w> </span><span class=n>T</span>: <span class=nc>Int</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>PartialOrd</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>DivAssign</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Copy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>count</span>: <span class=kt>usize</span> <span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ten</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>T</span>::<span class=n>ten</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>loop</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>ten</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>count</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>n</span><span class=w> </span><span class=o>/=</span><span class=w> </span><span class=n>ten</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>count</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><code>T</code>에 <code>Int</code>뿐만 아니라 <code>PartialOrd</code>, <code>DivAssign</code>, <code>Copy</code>가 추가된 것을 볼 수 있다. <code>PartialOrd</code>는 비교(<code>>=</code>)를 위해, <code>DivAssign</code>은 나눈 뒤 대입(<code>/=</code>)을 위해 필요하다. 또한 대입(<code>=</code>, <code>/=</code>) 또는 비교(<code>>=</code>) 시 소유권 이전(move) 또는 빌림(borrow)이 발생하는데, 정수 데이터 타입은 모두 <code>Copy</code> 타입이므로, <code>T</code>에 <code>Copy</code> 트레잇을 추가했다.</p><p>다음과 같이 간단히 테스트를 만들어 돌려보면 잘 동작하는 것을 확인할 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[test]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>test_1</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=mi>10</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>count_digit</span><span class=p>(</span><span class=n>i</span><span class=p>),</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[test]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>test_2</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>10</span><span class=o>..</span><span class=mi>100</span><span class=kt>u128</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>count_digit</span><span class=p>(</span><span class=n>i</span><span class=p>),</span><span class=w> </span><span class=mi>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[test]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>test_types</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>count_digit</span><span class=p>(</span><span class=mi>101</span><span class=k>i8</span><span class=p>),</span><span class=w> </span><span class=mi>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>count_digit</span><span class=p>(</span><span class=mi>101</span><span class=k>u8</span><span class=p>),</span><span class=w> </span><span class=mi>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>count_digit</span><span class=p>(</span><span class=mi>12345</span><span class=k>u16</span><span class=p>),</span><span class=w> </span><span class=mi>5</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>count_digit</span><span class=p>(</span><span class=mi>12345</span><span class=k>i16</span><span class=p>),</span><span class=w> </span><span class=mi>5</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Clojure는 <code>BigInt</code> 타입에 대해서도 함수를 그대로 사용할 수 있지만, Rust 구현은 그렇지 못하다. Rust에서 <code>BigInt</code>를 사용하려면 외부 라이브러리를 사용해야 하며, <code>BigInt</code>는 <code>Copy</code> 타입이 아니므로 코드를 조금 수정해야 한다.
<a href=https://crates.io/crates/num>num</a> 크레잇에는 <code>BigInt</code>뿐 아니라 위에서 정의한 <code>Int</code> 트레잇과 비슷한 <code>Num</code> 트레잇이 있다. <code>num</code> 크레잇을 사용한 <code>count_digits</code> 구현은 <a href=https://github.com/ntalbs/euler-rs/blob/main/src/util.rs#L234-L245>여기</a>를 참조할 수 있다.</p><p><code>count_digits</code> 구현에서 빠뜨린 것이 하나 더 있다. 바로 음수 처리다. <code>count_digits</code> 함수에 음수를 넣으면 항상 1을 리턴한다. 언듯 생각하면 쉽게 해결할 수 있을 것 같다. 음수가 주어지면 양수로 바꿔서 계산하면 되기 때문이다. 그런데 양수로 바꾸는 부분에서 문제가 생긴다.</p><p>함수 파라미터 타입이 <code>T</code>인 것에 주의해야 한다. 예를 들어 <code>n</code>이 음수인 경우 <code>n = -n</code>으로 양수로 바꿀 수 있을 것 같다. <code>-n</code>과 같이 쓰려면 <code>T</code>는 <code>Neg</code> 트레잇을 구현해야 하는데, 그러면 <code>u8</code>, <code>u16</code>과 같은 부호 없는 정수 타입을 사용할 수 없게 된다. <code>n.abs()</code>를 이용해 계산 전에 항상 양수로 바꿔주는 방법을 고려할 수도 있지만, <code>T</code>에는 <code>abs</code> 메서드가 없다.</p><p>음수를 처리하려면 다른 방법을 생각해야 한다. 기본 알고리즘은 어차피 주어진 숫자를 10으로 몇 번 나눌 수 있는지 확인하는 것이다. 함수 코드를 조금 바꾸면 음수에서도 동작하도록 수정할 수 있다. 문제가 되는 부분은 10과 비교하는 부분이다. 함수 인자로 음수가 주어지면 항상 10보다 작기 때문에 바로 리턴해버리는 것이 문제다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=w>    </span><span class=k>loop</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>ten</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// true when n is negative
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>count</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span></code></pre></div><p>따라서 <code>if n &lt; ten</code>을 <code>if n == 0</code>와 같은 식으로 바꾸면 음수를 지원할 수 있다. <code>T</code> 타입에 대한 0을 얻을 수 있도록 <code>Int</code> 트레잇에 <code>zero()</code> 함수를 추가한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>trait</span><span class=w> </span><span class=n>Int</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>ten</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>zero</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><code>impl_int_for!</code> 매크로에도 <code>zero()</code> 함수 구현을 추가해야 한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>macro_rules</span><span class=o>!</span><span class=w> </span><span class=n>impl_int_for</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>(</span><span class=w> </span><span class=cp>$(</span><span class=w> </span><span class=cp>$t</span>:<span class=nc>ty</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=cp>$(</span><span class=w> </span><span class=k>impl</span><span class=w> </span><span class=n>Int</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=cp>$t</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>fn</span> <span class=nf>zero</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>fn</span> <span class=nf>ten</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=p>)</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>그리고 <code>count_digits</code> 함수를 다음과 같이 수정한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>count_digit</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=k>mut</span><span class=w> </span><span class=n>n</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>usize</span>
</span></span><span class=line><span class=cl><span class=nc>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>T</span>: <span class=nc>Int</span><span class=w> </span><span class=o>+</span><span class=nb>PartialOrd</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>DivAssign</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Copy</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>zero</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>T</span>::<span class=n>zero</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>zero</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>ten</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>T</span>::<span class=n>ten</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>count</span>: <span class=kt>usize</span> <span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>loop</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>zero</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>count</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>n</span><span class=w> </span><span class=o>/=</span><span class=w> </span><span class=n>ten</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>count</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>수정된 함수에서는 <code>count</code>를 0으로 초기화하기 때문에, 함수 인자로 0이 입력되면 0을 리턴하는 문제가 있다. 따라서 함수 윗 부분에 <code>if</code> 조건을 추가해 인자가 0인 경우에는 바로 1을 리턴하도록 했다. 테스트에 음수를 추가해보면 잘 동작하는 것을 확인할 수 있다.</p><h2 id=참고>참고</h2><ul><li><a href=https://gist.github.com/ntalbs/5c0627a1524c6857a7d6fff4f7bff3e2>count_digits 전체 코드</a></li><li><a href=https://doc.rust-lang.org/reference/types/numeric.html>Rust Numeric types</a></li><li><a href=https://crates.io/crates/num>num</a></li><li><a href=https://github.com/ntalbs/euler-rs/blob/main/src/util.rs#L234-L245>num을 이용한 count_digits 구현</a></li><li><a href=https://ntalbs.github.io/2015/number-of-digits/>정수 자릿수 구하기(Clojure)</a></li></ul></section><footer class=post-footer><div class="social button-box"><a href=https://twitter.com/share class=twitter-share-button data-show-count=false>Tweet</a>
<a class=twitter-follow-button href=https://twitter.com/ntalbs data-show-count=false>Follow @ntalbs</a>
<script async src=//platform.twitter.com/widgets.js></script></div><nav id=article-nav><a class="article-nav-link-wrap previous" href=/2023/implementing-ratio-in-rust/ id=article-nav-newer>Rust에서 분수 타입 구현</a>
<a class="article-nav-link-wrap next" href=/2023/layoff/ id=article-nav-older>감원</a></nav></footer></article></main><section class=section><div class=container><aside><div id=disqus_thread></div></aside><script type=text/javascript>var disqus_shortname="ntalbs-stuff",permalink="https://ntalbs.github.io/2023/count-digits-in-rust/".replace(/\//g,"/"),disqus_config=function(){this.page.url=permalink,this.page.identifier=permalink};(function(){var e=document,t=e.createElement("script");t.src="https://"+disqus_shortname+".disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p></p></div></section><script src=/js/index.js type=text/javascript></script><footer class=page-bottom><div class=inner><section class=copyright>© 2008-2024 <a href=/about>ntalbs</a></section><section class=poweredby>Powered by <a class=icon-ghost href=https://gohugo.io>Hugo</a></section></div></footer></body></html>