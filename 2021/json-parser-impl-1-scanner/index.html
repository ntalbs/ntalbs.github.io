<!doctype html><html><head><script src=/js/mode.js type=text/javascript></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3882204692252974" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-2098194-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-2098194-3")</script><meta name=google-site-verification content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE"><meta charset=utf-8><meta http-equiv=content-language content="ko-KR"><meta name=description content="자바로 JSON 파서 구현하기 1부 - 스캐너"><meta name=keywords content="자바,Java,JSON parser,scanner"><meta property="og:title" content="JSON 파서 구현 1 - 스캐너 @ntalbs' stuff"><meta property="og:site_name" content="@ntalbs' stuff"><meta property="og:url" content="https://ntalbs.github.io/2021/json-parser-impl-1-scanner/"><meta property="og:description" content="자바로 JSON 파서 구현하기 1부 - 스캐너"><meta name=og:image content="https://ntalbs.github.io/images/ntalbs.jpg"><meta name=twitter:card content="summary"><meta name=twitter:site content="@ntalbs"><meta name=twitter:creator content="@ntalbs"><meta name=viewport content="width=device-width,initial-scale=1"><title>JSON 파서 구현 1 - 스캐너 @ntalbs' stuff</title><link rel="shortcut icon" href=/images/favicon.ico><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/highlight.css></head><body><div id=progress><div id=bar></div><div class=container><div id=scroll-title>JSON 파서 구현 1 - 스캐너</div></div></div><nav class=navbar role=navigation><div class=container><div class=navbar-header><button type=button class="navbar-toggle unselectable" data-toggle=collapse data-target=#nav-items>+</button>
<a class="navbar-brand unselectable" href=/>@ntalbs' stuff</a></div><div class="navbar-items collapsed" id=nav-items><ul><li><input id=search type=search placeholder="Search this site" autocomplete=off></li><li><a class=unselectable href=/archive/>Archive</a></li><li><a class=unselectable href=/tags/>Tags</a></li><li><a class=unselectable href=/about/>About</a></li><li><a id=mode-switch class=unselectable href=#><svg data-bs-theme-value="dark" xmlns="http://www.w3.org/2000/svg" class="icon-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg><svg data-bs-theme-value="light" xmlns="http://www.w3.org/2000/svg" class="icon-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></a></li></ul></div></div></nav><header class=page-head><div class=container><p class=blog-description>내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p></div></header><main class=container role=main><article class=post><header><p class=post-meta><time datetime=2021-10-24 itemprop=datePublished>2021-10-24</time>
on
<a href=/tags/java/>java</a></p><h1 class=post-title>JSON 파서 구현 1 - 스캐너</h1></header><section class=post-content><p><a href=https://en.wikipedia.org/wiki/Lex_(software)>Lex</a>나 <a href=https://en.wikipedia.org/wiki/Yacc>Yacc</a>와 같은 스캐너/파서 생성기를 사용하지 않고 JSON 파서를 구현하는 방법을 2부에 걸쳐 정리하려 한다. 시리즈를 끝까지 읽고 나면, JSON 파서를 만드는 게 생각보다 어렵지 않음을 알게 될 것이다.</p><p>1부에서는 스캐너를 설명할 것이다. 스캐너(scanner)는 입력 코드를 읽어 토큰(token)의 열(series)로 바꿔주는 프로그램이다. 렉서(lexer) 또는 어휘 분석기(lexical analyser)라 불리기도 한다. 토큰 열은 이후 파서의 입력이 된다.</p><h2 id=렉심과-토큰>렉심과 토큰</h2><p>다음과 같은 간단한 JSON을 생각해보자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span> <span class=s2>&#34;a&#34;</span><span class=o>:</span> <span class=s2>&#34;hello&#34;</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=o>:</span> <span class=mi>10</span> <span class=p>}</span>
</span></span></code></pre></div><p>여기서 <code>{</code>는 JSON 객체의 시작을, <code>"a"</code>는 속성의 이름을, <code>"hello"</code>는 <code>"a"</code>의 값을 나타낸다. 그러나 <code>"hello"</code>에서 <code>ello</code>만 취한다면 이건 아무것도 의미하지 않는다. 이렇게 입력 코드에서 어떤 의미를 가지는 가장 작은 문자열 조각을 렉심(lexeme)이라 한다.</p><p>파서에서 문자열 비교를 통해 렉심 종류를 파악할 수도 있지만, 그렇게 하는 것은 속도도 느리고 우아하지도 않다. 렉심을 분리해낸 다음 바로 렉심의 종류도 함께 저장해두는 것이 낫다. 이걸 토큰(token)이라 한다. 토큰은 렉심의 종류, 소스 문자열(렉심), 그리고 경우에 따라 리터럴 값을 갖는다.</p><p><code>Token</code>은 다음과 같이 정의할 수 있다. Java 14에서 도입된 레코드를 사용했다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>record</span> <span class=nf>Token</span><span class=o>(</span>
</span></span><span class=line><span class=cl>  <span class=n>TokenType</span> <span class=n>type</span><span class=o>,</span>
</span></span><span class=line><span class=cl>  <span class=n>String</span> <span class=n>lexeme</span><span class=o>,</span>
</span></span><span class=line><span class=cl>  <span class=n>Object</span> <span class=n>literal</span>
</span></span><span class=line><span class=cl><span class=o>)</span> <span class=o>{}</span>
</span></span></code></pre></div><p>토큰 타입은 다음과 같이 정의할 수 있다. <code>{</code>, <code>}</code>, <code>[</code>, <code>]</code>, <code>:</code>, <code>,</code>가 JSON에서 쓰인다. 문자열 리터럴과 숫자 리터럴, 그리고 <code>true</code>, <code>false</code>, <code>null</code> 키워드도 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>enum</span> <span class=n>TokenType</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>LEFT_BRACE</span><span class=o>,</span> <span class=n>RIGHT_BRACE</span><span class=o>,</span>
</span></span><span class=line><span class=cl>  <span class=n>LEFT_BRACKET</span><span class=o>,</span> <span class=n>RIGHT_BRACKET</span><span class=o>,</span>
</span></span><span class=line><span class=cl>  <span class=n>COLON</span><span class=o>,</span> <span class=n>COMMA</span><span class=o>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>STRING</span><span class=o>,</span> <span class=n>NUMBER</span><span class=o>,</span>
</span></span><span class=line><span class=cl>  <span class=n>TRUE</span><span class=o>,</span> <span class=n>FALSE</span><span class=o>,</span> <span class=n>NULL</span><span class=o>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>EOF</span><span class=o>,</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=스캐너-클래스>스캐너 클래스</h2><p>이제 스캐너 구현을 시작해보자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Scanner</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>source</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Token</span><span class=o>&gt;</span> <span class=n>tokens</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>Scanner</span><span class=o>(</span><span class=n>String</span> <span class=n>source</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>source</span> <span class=o>=</span> <span class=n>source</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>tokens</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>입력 JSON 문자열을 읽어 토큰을 하나씩 생성해 <code>tokens</code> 리스트에 채울 것이다. 문자열을 읽어가며 토큰을 생성하는 루프는 다음과 같이 쓸 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=n>List</span><span class=o>&lt;</span><span class=n>Token</span><span class=o>&gt;</span> <span class=nf>scanTokens</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=o>(!</span><span class=n>isAtEnd</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>start</span> <span class=o>=</span> <span class=n>current</span><span class=o>;</span>
</span></span><span class=line><span class=cl>      <span class=n>scanToken</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>tokens</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>Token</span><span class=o>(</span><span class=n>EOF</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>,</span> <span class=kc>null</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>tokens</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><p>스캐너는 입력 문자열 끝까지 읽으며 토큰을 생성해 리스트에 넣는다. 마지막에 <code>EOF</code> 토큰을 넣는데, 꼭 필요한 건 아니지만 이렇게 하면 나중에 파서 코드를 좀더 깔끔하게 작성할 수 있다.</p><p>루프 안에서 스캐너가 문자열의 어느 부분을 스캔하고 있는지 나타내기 위해 <code>start</code>와 <code>current</code> 필드를 사용하고 있다. 따라서 <code>tokens</code> 밑에 두 필드를 추가한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>int</span> <span class=n>start</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>int</span> <span class=n>current</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>...</span>
</span></span></code></pre></div><p><code>start</code>는 현재 스캔하고 있는 lexeme의 첫 문자를 가리키는 인덱스고, <code>current</code>는 현재 스캔하고 있는 문자의 인덱스다.</p><p>그리고 다음과 같이 입력 문자열을 끝까지 읽었는지 확인하는 함수가 필요하다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isAtEnd</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>current</span> <span class=o>&gt;=</span> <span class=n>source</span><span class=o>.</span><span class=na>length</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><h2 id=렉심-인식>렉심 인식</h2><p>위 <code>scanTokens()</code>에서는 루프를 돌면서 토큰을 하나씩 스캔한다. 이 부분이 스캐너의 핵심이다. 제일 간단한 토큰부터 생각해보자. 문자 하나가 토큰이라면 한 글자씩 읽어 토큰으로 바꾸면 된다. JSON에서 문자 하나로 된 토큰은 다음과 같다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span> <span class=nf>scanToken</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>c</span> <span class=o>=</span> <span class=n>advance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=o>(</span><span class=n>c</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;{&#39;</span> <span class=o>-&gt;</span> <span class=n>addToken</span><span class=o>(</span><span class=n>LEFT_BRACE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;}&#39;</span> <span class=o>-&gt;</span> <span class=n>addToken</span><span class=o>(</span><span class=n>RIGHT_BRACE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;[&#39;</span> <span class=o>-&gt;</span> <span class=n>addToken</span><span class=o>(</span><span class=n>LEFT_BRACKET</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;]&#39;</span> <span class=o>-&gt;</span> <span class=n>addToken</span><span class=o>(</span><span class=n>RIGHT_BRACKET</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;:&#39;</span> <span class=o>-&gt;</span> <span class=n>addToken</span><span class=o>(</span><span class=n>COLON</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;,&#39;</span> <span class=o>-&gt;</span> <span class=n>addToken</span><span class=o>(</span><span class=n>COMMA</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39; &#39;</span><span class=o>,</span> <span class=sc>&#39;\n&#39;</span><span class=o>,</span> <span class=sc>&#39;\t&#39;</span><span class=o>,</span> <span class=sc>&#39;\r&#39;</span> <span class=o>-&gt;</span> <span class=o>{}</span> <span class=c1>// ignore whitespace
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><p>여기서도 다음과 같은 도우미 함수가 사용되었다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>char</span> <span class=nf>advance</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>source</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>current</span><span class=o>++);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span> <span class=nf>addToken</span><span class=o>(</span><span class=n>TokenType</span> <span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>addToken</span><span class=o>(</span><span class=n>type</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span> <span class=nf>addToken</span><span class=o>(</span><span class=n>TokenType</span> <span class=n>type</span><span class=o>,</span> <span class=n>Object</span> <span class=n>literal</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>text</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=n>start</span><span class=o>,</span> <span class=n>current</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>tokens</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>Token</span><span class=o>(</span><span class=n>type</span><span class=o>,</span> <span class=n>text</span><span class=o>,</span> <span class=n>literal</span><span class=o>));</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><p><code>advance()</code>는 현재 문자를 리턴하고 <code>current</code> 인덱스를 하나 증가시킨다. <code>addToken()</code>은 스캔한 토큰을 <code>tokens</code> 리스트에 추가한다.</p><h2 id=문자열-리터럴>문자열 리터럴</h2><p>문자열 리터럴을 처리하기 위해 <code>scanToken()</code>의 <code>switch</code>에 다음을 추가한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;&#34;&#39;</span> <span class=o>-&gt;</span> <span class=n>string</span><span class=o>();</span>
</span></span></code></pre></div><p>문자열은 항상 <code>"</code>로 시작하므로, <code>"</code>을 만나면 문자열 시작으로 판단하고 <code>string()</code>을 호출한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span> <span class=nf>string</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=o>(</span><span class=n>peek</span><span class=o>()</span> <span class=o>!=</span> <span class=sc>&#39;&#34;&#39;</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>isAtEnd</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>advance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>isAtEnd</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=s>&#34;Unterminated string&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>advance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>value</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=n>start</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>current</span> <span class=o>-</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>addToken</span><span class=o>(</span><span class=n>STRING</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><p><code>string()</code>에서는 다음 <code>"</code>을 만날 때까지 읽기를 계속한다. 입력 코드의 끝까지 읽었는데 <code>"</code>를 만나지 못하면 예외를 던진다. <code>string()</code>에서는 <code>peek()</code> 도우미 함수를 사용한다. 토큰을 저장할 때 문자열 리터럴(따옴표 안의 문자열)도 함께 저장한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>char</span> <span class=nf>peek</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>isAtEnd</span><span class=o>())</span> <span class=k>return</span> <span class=sc>&#39;\0&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>source</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>current</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><p><code>peek()</code>는 <code>advance()</code>와 비슷하지만 <code>current</code> 인덱스를 증가시키지 않는다.</p><h2 id=숫자-리터럴>숫자 리터럴</h2><p>숫자 리터럴을 처리하기 위해 <code>scanToken()</code>의 <code>switch</code>에 다음을 추가한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;-&#39;</span><span class=o>,</span> <span class=sc>&#39;0&#39;</span><span class=o>,</span> <span class=sc>&#39;1&#39;</span><span class=o>,</span> <span class=sc>&#39;2&#39;</span><span class=o>,</span> <span class=sc>&#39;3&#39;</span><span class=o>,</span> <span class=sc>&#39;4&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>           <span class=sc>&#39;5&#39;</span><span class=o>,</span> <span class=sc>&#39;6&#39;</span><span class=o>,</span> <span class=sc>&#39;7&#39;</span><span class=o>,</span> <span class=sc>&#39;8&#39;</span><span class=o>,</span> <span class=sc>&#39;9&#39;</span> <span class=o>-&gt;</span> <span class=n>number</span><span class=o>();</span>
</span></span></code></pre></div><p><code>0</code> ~ <code>9</code> 또는 <code>-</code>를 만다면 숫자가 시작하는 것으로 판단하고 <code>number()</code> 도우미 함수를 호출한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span> <span class=nf>number</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>peek</span><span class=o>()</span> <span class=o>==</span> <span class=sc>&#39;-&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>advance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=o>(</span><span class=n>isDigit</span><span class=o>(</span><span class=n>peek</span><span class=o>()))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>advance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>peek</span><span class=o>()</span> <span class=o>==</span> <span class=sc>&#39;.&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>isDigit</span><span class=o>(</span><span class=n>peekNext</span><span class=o>()))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>advance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=o>(</span><span class=n>isDigit</span><span class=o>(</span><span class=n>peek</span><span class=o>()))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>advance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>addToken</span><span class=o>(</span><span class=n>NUMBER</span><span class=o>,</span> <span class=n>Double</span><span class=o>.</span><span class=na>parseDouble</span><span class=o>(</span><span class=n>source</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=n>start</span><span class=o>,</span> <span class=n>current</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><p>처음 문자가 <code>-</code>면 다음 문자로 넘어간다. 문자가 숫자면 다른 문자가 나올 때까지 계속 읽는다. 마침표(<code>.</code>)가 나오고 그 다음 문자가 숫자면 마침표를 소숫점으로 인식하고 넘어간다. 그 다음 계속 숫자를 읽어나간다. 이후 숫자 이외의 문자를 만나면 숫자 렉심이 끝난다. 숫자 렉심을 잘라낸 다음 <code>Double.parseDoule()</code>로 <code>double</code>로 바꾼다. <code>number()</code>에서는 다음 도우미 함수를 사용한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isDigit</span><span class=o>(</span><span class=kt>char</span> <span class=n>c</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span> <span class=o>&gt;=</span> <span class=sc>&#39;0&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=sc>&#39;9&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><p><code>isDigit()</code>는 <code>0</code>부터 <code>9</code>까지 문자를 숫자로 판단한다. <code>.</code>를 만났을 때는 그 다음 문자가 숫자인지 봐야 <code>.</code>가 소숫점으로 사용됐는지 확인할 수 있다. 따라서 다음 문자를 확인하는 도우미 함수를 추가한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>char</span> <span class=nf>peekNext</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>current</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>&gt;=</span> <span class=n>source</span><span class=o>.</span><span class=na>length</span><span class=o>())</span> <span class=k>return</span> <span class=sc>&#39;\0&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>source</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>current</span> <span class=o>+</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><p>JSON에서는 숫자를 과학적 표기법(scientific notation)으로 써도 되고, Java의 <code>Double.parseDouble()</code>도 과학적 표기법으로 작성된 숫자를 문제없이 한다. 따라서 <code>number()</code> 함수에 코드를 조금 더 추가하면 과학적 표기법으로 작성된 숫자도 지원할 수 있지만, 여기서는 생략한다.</p><h2 id=true-false-null>true, false, null</h2><p>마지막으로 <code>scanToken()</code>의 <code>switch</code>에 다음을 추가한다. 위에서 나열한 경우가 아니면 모두 <code>default</code> 브랜치로 넘어간다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>      <span class=k>default</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>isAlpha</span><span class=o>(</span><span class=n>c</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>          <span class=n>keyword</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>          <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=s>&#34;Unexpected token.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span></code></pre></div><p><code>isAlpha()</code> 도우미 함수의 구현은 다음과 같다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isAlpha</span><span class=o>(</span><span class=kt>char</span> <span class=n>c</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>(</span><span class=n>c</span> <span class=o>&gt;=</span> <span class=sc>&#39;A&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=sc>&#39;Z&#39;</span><span class=o>)</span> <span class=o>||</span> <span class=o>(</span><span class=n>c</span> <span class=o>&gt;=</span> <span class=sc>&#39;a&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span><span class=o>&lt;=</span> <span class=sc>&#39;z&#39;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><p>JSON에서 키워드라 할 만한 것은 <code>true</code>, <code>false</code>, <code>null</code> 뿐이다. 렉심이 셋 중 하나에 해당하면 그에 대응하는 토큰을 추가하고, 그렇지 않은 경우는 예외를 던진다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span> <span class=nf>keyword</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=o>(</span><span class=n>isAlpha</span><span class=o>(</span><span class=n>peek</span><span class=o>()))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>advance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>text</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=n>start</span><span class=o>,</span> <span class=n>current</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=o>(</span><span class=n>text</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s>&#34;true&#34;</span> <span class=o>-&gt;</span> <span class=n>addToken</span><span class=o>(</span><span class=n>TRUE</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s>&#34;false&#34;</span> <span class=o>-&gt;</span> <span class=n>addToken</span><span class=o>(</span><span class=n>FALSE</span><span class=o>,</span> <span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s>&#34;null&#34;</span> <span class=o>-&gt;</span> <span class=n>addToken</span><span class=o>(</span><span class=n>NULL</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span> <span class=o>-&gt;</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=s>&#34;Unexpected token: &#34;</span> <span class=o>+</span> <span class=n>text</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>};</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span></code></pre></div><h2 id=다음-단계>다음 단계</h2><p>이렇게 100줄 조금 넘는 코드로 JSON 스캐너를 만들었다. <code>scanTokens()</code>는 토큰 리스트 <code>List&lt;Token></code>을 리턴한다. 파서는 이 토큰 리스트를 이용해 JSON을 나타내는 데이터 구조를 생성할 것이다. JSON 파서에 대한 설명은 2부에서 이어진다.</p><h2 id=참고>참고</h2><ul><li>Robert Nystrom, <a href=https://craftinginterpreters.com/contents.html>Crafting Interpreters</a> Chapter 4<br>위에서 설명한 코드는 사실 이 책에 나오는 코드를 JSON에 맞게 약간 수정한 것에 불과하다. 놀랍게도 웹사이트에 책 전체 내용이 공개되어 있다.</li><li><a href=https://github.com/ntalbs/JsonParser>JsonParser</a><br>위에서 설명한 코드 전체를 확인할 수 있다.</li><li><a href=https://github.com/ntalbs/json_parser>json_parser</a><br>위 설명의 Rust 구현을 확인할 수 있다.</li></ul></section><footer class=post-footer><div class="social button-box"><a href=https://twitter.com/share class=twitter-share-button data-show-count=false>Tweet</a>
<a class=twitter-follow-button href=https://twitter.com/ntalbs data-show-count=false>Follow @ntalbs</a>
<script async src=//platform.twitter.com/widgets.js></script></div><nav id=article-nav><a class="article-nav-link-wrap previous" href=/2021/json-parser-impl-2-parser/ id=article-nav-newer>JSON 파서 구현 2 - 파서</a>
<a class="article-nav-link-wrap next" href=/2021/shell-script-in-java/ id=article-nav-older>Java 셸 스크립트</a></nav></footer></article></main><section class=section><div class=container><aside><div id=disqus_thread></div></aside><script type=text/javascript>var disqus_shortname="ntalbs-stuff",permalink="https://ntalbs.github.io/2021/json-parser-impl-1-scanner/".replace(/\//g,"/"),disqus_config=function(){this.page.url=permalink,this.page.identifier=permalink};(function(){var e=document,t=e.createElement("script");t.src="https://"+disqus_shortname+".disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p></p></div></section><script src=/js/index.js type=text/javascript></script><footer class=page-bottom><div class=inner><section class=copyright>© 2008-2023 <a href=/about>ntalbs</a></section><section class=poweredby>Powered by <a class=icon-ghost href=https://gohugo.io>Hugo</a></section></div></footer></body></html>