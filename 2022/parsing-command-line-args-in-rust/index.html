<!doctype html><html><head><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3882204692252974" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-2098194-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-2098194-3')</script><meta charset=utf-8><meta name=google-site-verification content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE"><meta property="og:image" content="https://ntalbs.github.io/images/ntalbs.jpg"><meta name=viewport content="width=device-width,initial-scale=1"><title>Rust에서 명령행 인자 파싱 @ntalbs' stuff</title><link rel="shortcut icon" href=/images/favicon.ico><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/highlight.css></head><body><div id=progress><div id=bar></div><div class=container><div id=scroll-title>Rust에서 명령행 인자 파싱</div></div></div><nav class=navbar role=navigation><div class=container><div class=navbar-header><button type=button class="navbar-toggle unselectable" data-toggle=collapse data-target=#nav-items>+</button>
<a class="navbar-brand unselectable" href=/>@ntalbs' stuff</a></div><div class="navbar-items collapsed" id=nav-items><ul><li><a class=unselectable href=/archive/>Archive</a></li><li><a class=unselectable href=/tags/>Tags</a></li><li><a class=unselectable href=/about/>About</a></li><li><a id=mode-switch class=unselectable href=#></a></li></ul></div></div></nav><header class=page-head><div class=container><p class=blog-description>내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p></div></header><main class=container role=main><article class=post><header><p class=post-meta><time datetime=2022-05-20 itemprop=datePublished>2022-05-20</time>
on
<a href=/tags/rust/>rust</a></p><h1 class=post-title>Rust에서 명령행 인자 파싱</h1></header><section class=post-content><p>Rust에서는 명령행 인자를 어떻게 처리할까? 예전에 Rust로 작성한 HTTP 에코 서버 <a href=https://ntalbs.github.io/2021/echo-server-in-rust/>reflexive</a>는 포트 번호가 하드코딩 되어 있고 워커 개수는 디폴트 값을 사용하고 있는데, 포트 번호와 워커 개수를 명령행 인자로 받으려면 어떻게 해야 할까?</p><h2 id=stdenvargs>std::env::args()</h2><p>Rust에서는 표준 라이브러리에 있는 <a href=https://doc.rust-lang.org/1.39.0/std/env/fn.args.html><code>std::env::args()</code></a>를 통해 명령행 인자를 얻을 수 있다. <code>std::env::args()</code>의 리턴 타입은 <a href=https://doc.rust-lang.org/1.39.0/std/env/struct.Args.html><code>std::env::Args</code></a>인데, 명령행 인자에 대한 반복자(iterator)다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span>::<span class=n>env</span>::<span class=n>args</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;{:?}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;--&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;{}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>이 프로그램을 컴파일한 수 명령행 인자를 주어 실행하면 다음과 같은 결과를 얻을 수 있다. <code>cargo run</code>으로 프로그램을 실행할 때 <code>--</code> 다음에 나오는 인자는 애플리케이션 프로그램에 (<code>cargo</code>가 아니라) 전달된다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> cargo run -- --port <span class=m>4000</span> --workers <span class=m>6</span>
</span></span><span class=line><span class=cl><span class=go>Args { inner: [&#34;./target/debug/arg-test&#34;, &#34;--port&#34;, &#34;4000&#34;, &#34;--workers&#34;, &#34;6&#34;] }
</span></span></span><span class=line><span class=cl><span class=go>--
</span></span></span><span class=line><span class=cl><span class=go>./target/debug/arg-test
</span></span></span><span class=line><span class=cl><span class=go>--port
</span></span></span><span class=line><span class=cl><span class=go>4000
</span></span></span><span class=line><span class=cl><span class=go>--workers
</span></span></span><span class=line><span class=cl><span class=go>6
</span></span></span></code></pre></div><p>인자 값을 모두 얻었으니 필요에 맞게 쓰면 되지만, 인자를 입맛에 맞게 쓰려면 작업이 좀 필요하다. 예를 들어 <code>port</code>에는 정수 4000을, <code>workers</code>에는 정수 6을 할당해 프로그램에서 사용하려면 어떻게 해야 할까?</p><p>명령행 인자를 제대로 처리하려면 다음과 같은 경우도 어떻게 처리할 지 고려해야 한다.</p><ul><li>필수 인자를 빠뜨린 경우</li><li><code>--port 3000 --port 4000</code>과 같이 같은 인자를 여러 번 지정한 경우</li><li><code>--port abc</code>와 같이 <code>port</code>에 숫자가 아닌 엉뚱한 문자열을 지정한 경우</li><li>프로그램에서 지원하지 않는 인자를 지정한 경우</li><li>도움말 또는 사용법 표시</li></ul><p>이 모든 경우를 제대로 처리하려면 명령행 인자 파서를 작성해야 한다. 간단한 작업은 아닐 것이다.</p><h2 id=clap>Clap</h2><p>Rust에서 사용할 수 있는 명령행 인자 파서는 여러 가지가 있지만, 그 중 <a href=https://docs.rs/clap/latest/clap/>Clap</a>이 가장 먼저 눈에 들어왔다. 특별한 이유가 있다기 보다는, 처음 읽은 문서가 Clap을 설명하는 것이었다. Clap은 선언적(또는 절차적)으로 명령행 인자 파서를 생성할 수 있게 해주는 라이브러리다.</p><p>Clap을 사용하려면 다음과 같이 <code>Cargo.toml</code>에 종속성을 추가해야 한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>dependencies</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>clap</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;3&#34;</span><span class=p>,</span> <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;derive&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></div><p>그리고 다음과 같이 명령행 인자 값을 저장할 구조체를 만든다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[derive(Debug, Parser)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>port</span>: <span class=kt>u16</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>workers</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><code>main</code> 함수는 다음과 같이 수정한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arguments</span>::<span class=n>parse</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;{:?}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><code>cargo run</code>으로 프로그램을 실행하면 다음과 같은 에러 메시지가 표시된다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>error: The following required arguments were not provided:
</span></span></span><span class=line><span class=cl><span class=go>    &lt;PORT&gt;
</span></span></span><span class=line><span class=cl><span class=go>    &lt;WORKERS&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>USAGE:
</span></span></span><span class=line><span class=cl><span class=go>    arg-test &lt;PORT&gt; &lt;WORKERS&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>For more information try --help
</span></span></span></code></pre></div><p><code>-h</code> 또는 <code>--help</code>를 프로그램 인자로 제공하면 도움말이 표시된다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>arg-test
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>USAGE:
</span></span></span><span class=line><span class=cl><span class=go>    arg-test &lt;PORT&gt; &lt;WORKERS&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ARGS:
</span></span></span><span class=line><span class=cl><span class=go>    &lt;PORT&gt;
</span></span></span><span class=line><span class=cl><span class=go>    &lt;WORKERS&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>OPTIONS:
</span></span></span><span class=line><span class=cl><span class=go>    -h, --help    Print help information
</span></span></span></code></pre></div><p>포트 번호나 워커 개수에 양의 정수가 아닌 다른 값을 지정하면 에러가 발생한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> cargo run -- hello world
</span></span><span class=line><span class=cl><span class=go>error: Invalid value &#34;hello&#34; for &#39;&lt;PORT&gt;&#39;: invalid digit found in string
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>For more information try --help
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> cargo run -- -- -8080 <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=go>error: Invalid value &#34;-8080&#34; for &#39;&lt;PORT&gt;&#39;: invalid digit found in string
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>For more information try --help
</span></span></span></code></pre></div><p>다음과 같이 명령행 인자를 제대로 지정하면 <code>Arguments</code> 구조체 필드에 값이 설정된다. 프로그램에서 이 값을 사용하면 된다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> cargo run -- <span class=m>8080</span> <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=go>Arguments { port: 8080, workers: 10 }
</span></span></span></code></pre></div><p>단지 몇 줄의 코드로 이 모든 게 처리된다. 따로 명령행 인자 파서를 작성할 필요도 없고, 에러 처리 코드를 작성할 필요도 없다.</p><h2 id=플래그-추가>플래그 추가</h2><p>Clap에서는 플래그 인자를 추가하는 것도 매우 간단하다. <code>Arguments</code> 구조체 멤버에 <code>#[clap(short, long)]</code> 매크로 어노테이션을 추가하면 끝이다. 여기서 <code>short</code>는 <code>-p</code>와 같이 짧은 플래그를, <code>long</code>은 <code>--port</code>와 같이 긴 플래그를 뜻한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[derive(Debug, Parser)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Arguments</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[clap(short, long)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>port</span>: <span class=kt>u16</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[clap(short, long)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>workers</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><code>cargo run -- --help</code>으로 프로그램을 실행하면 다음과 같은 에러 메시지가 표시된다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>arg-test
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>USAGE:
</span></span></span><span class=line><span class=cl><span class=go>    arg-test --port &lt;PORT&gt; --workers &lt;WORKERS&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>OPTIONS:
</span></span></span><span class=line><span class=cl><span class=go>    -h, --help                 Print help information
</span></span></span><span class=line><span class=cl><span class=go>    -p, --port &lt;PORT&gt;
</span></span></span><span class=line><span class=cl><span class=go>    -w, --workers &lt;WORKERS&gt;
</span></span></span></code></pre></div><p>이제 프로그램을 실행하려면 플래그를 지정해야 하지만, 인자 순서는 기억하지 않아도 된다. 즉, 인자를 <code>--port 4000 --workers 10</code>로 주나 <code>--workers 10 --port 4000</code>로 주나 결과는 같다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Arguments { port: 4000, workers: 10 }
</span></span></span></code></pre></div><h2 id=옵션-인자와-디폴트-값>옵션 인자와 디폴트 값</h2><p>프로그램을 실행할 때마나 포트와 워커 개수를 지정하는 것은 번거롭다. 명령행 인자를 지정하지 않으면 디폴트 값, 예를 들어 포트는 8080을, 워커 개수는 8을 사용하도록 할 수는 없을까?</p><p>인자 타입, 즉, <code>Arguments</code> 구조체에서 멤버의 타입을 <code>Option&lt;T></code>로 하면 인자를 옵션으로 만들 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[derive(Debug, Parser)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Arguments</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[clap(short, long)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>port</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=kt>u16</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[clap(short, long)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>workers</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=kt>usize</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>코드에서 <code>port</code>나 <code>workers</code> 값을 얻을 때 다음과 같이 하면 된다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arguments</span>::<span class=n>parse</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>args</span><span class=p>.</span><span class=n>port</span><span class=p>.</span><span class=n>unwrap_or</span><span class=p>(</span><span class=mi>8080</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>workers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>args</span><span class=p>.</span><span class=n>workers</span><span class=p>.</span><span class=n>unwrap_or</span><span class=p>(</span><span class=mi>8</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>이렇게 해도 동작은 하지만, 명령행 인자 정의하는 위치와 디폴트 값을 지정하는 위치가 달라지는 것이 불만이다. 더 깔끔한 방법은 다음과 같이 하는 것이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[derive(Debug, Parser)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Arguments</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[clap(short, long, default_value_t = 8080)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>port</span>: <span class=kt>u16</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[clap(short, long, default_value_t = 8)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>workers</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><code>cargo run -- --help</code>로 프로그램을 실행하면 다음과 같이 도움말이 표시된다. 도움말에 각 옵션의 디폴트 값도 추가되었다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>arg-test
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>USAGE:
</span></span></span><span class=line><span class=cl><span class=go>    arg-test [OPTIONS]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>OPTIONS:
</span></span></span><span class=line><span class=cl><span class=go>    -h, --help                 Print help information
</span></span></span><span class=line><span class=cl><span class=go>    -p, --port &lt;PORT&gt;          [default: 8080]
</span></span></span><span class=line><span class=cl><span class=go>    -w, --workers &lt;WORKERS&gt;    [default: 8]
</span></span></span></code></pre></div><p>아무런 인자 없이 프로그램을 실행하면 포트는 8080, 워커 개수는 8로 프로그램이 실행되는 것을 확인할 수 있다.</p><h2 id=프로그램-추가-설명>프로그램 추가 설명</h2><p>도움말에 프로그램 설명, 버전 등과 같은 간략한 추가 정보를 표시하고 싶을 때는 다음과 같이 어노테이션을 추가한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[derive(Debug, Parser)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[clap(author=</span><span class=s>&#34;ntalbs&#34;</span><span class=cp>, version, about=</span><span class=s>&#34;A very simple CLI test program.&#34;</span><span class=cp>)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Arguments</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><code>cargo run -- -h</code> 또는 <code>cargo run -- --help</code>로 프로그램을 실행하면 다음과 같이 도움말이 표시된다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>arg-test 0.1.0
</span></span></span><span class=line><span class=cl><span class=go>ntalbs
</span></span></span><span class=line><span class=cl><span class=go>A very simple CLI test program.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>USAGE:
</span></span></span><span class=line><span class=cl><span class=go>    arg-test [OPTIONS]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>OPTIONS:
</span></span></span><span class=line><span class=cl><span class=go>    -h, --help                 Print help information
</span></span></span><span class=line><span class=cl><span class=go>    -p, --port &lt;PORT&gt;          [default: 8080]
</span></span></span><span class=line><span class=cl><span class=go>    -V, --version              Print version information
</span></span></span><span class=line><span class=cl><span class=go>    -w, --workers &lt;WORKERS&gt;    [default: 8]
</span></span></span></code></pre></div><p><code>-V</code>(<code>--version</code>) 옵션이 추가된 것을 볼 수 있다. <code>-V</code> 또는 <code>--version</code> 옵션을 주어 프로그램을 실행하면 버전 정보를 표시한다. 어노테이션에서 버전 정보를 지정하지 않으면 <code>Cargo.toml</code>에 있는 프로그램 버전 정보가 사용된다.</p><h2 id=결론>결론</h2><p>Rust 프로그램에서 Clap을 사용해 명령행 인자를 처리하는 방법을 살펴보았다. 이런 마법을 좋아하지 않는 사람도 있지만, 나는 언제나 선언적 코드를 좋아했다. 어쨌는 여기서 내 주요 관심사는 내 프로그램의 CLI를 멋지게 만드는 것이지 명령행 인자 파서를 만드는 게 아니다. Clap을 사용하면 복잡한 코드를 작성하지 않고도 선언적으로 깔끔하고 우아하게 명령행 인자를 처리할 수 있다.</p><h2 id=참고>참고</h2><ul><li><a href=https://rust-cli.github.io/book/tutorial/cli-args.html>Parsing command-line arguments</a></li><li><a href=https://blog.logrocket.com/command-line-argument-parsing-rust-using-clap/>Command line argument parsing in Rust using Clap</a></li><li><a href=https://docs.rs/clap/latest/clap/>Clap</a></li><li><a href=https://github.com/ntalbs/reflexive-rs/blob/mainline/src/main.rs>reflexive</a> Clap을 사용해 <code>port</code>와 <code>workser</code>를 명령행 인자로 지정할 수 있도록 <a href=/2021/echo-server-in-rust/>Rust 에코 서버</a>를 수정한 코드를 볼 수 있다.</li></ul></section><footer class=post-footer><div class="social button-box"><a href=https://twitter.com/share class=twitter-share-button data-show-count=false>Tweet</a>
<a class=twitter-follow-button href=https://twitter.com/ntalbs data-show-count=false>Follow @ntalbs</a>
<script async src=//platform.twitter.com/widgets.js></script></div><nav id=article-nav><a class="article-nav-link-wrap previous" href=/2022/external-link-target-in-hugo/ id=article-nav-newer>Hugo: 외부 링크 새 탭에서 열기</a>
<a class="article-nav-link-wrap next" href=/2022/bad-luck-5/ id=article-nav-older>불운 5</a></nav></footer></article></main><section class=section><div class=container><aside><div id=disqus_thread></div></aside><script type=text/javascript>var disqus_shortname='ntalbs-stuff',permalink="https://ntalbs.github.io/2022/parsing-command-line-args-in-rust/".replace(/\//g,'/'),disqus_config=function(){this.page.url=permalink,this.page.identifier=permalink};(function(){var e=document,t=e.createElement('script');t.src='https://'+disqus_shortname+'.disqus.com/embed.js',t.setAttribute('data-timestamp',+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p></p></div></section><script src=https://ntalbs.github.io/js/index.js type=text/javascript></script>
<script src=https://ntalbs.github.io/js/mode.js type=text/javascript></script><footer class=page-bottom><div class=inner><section class=copyright>© 2008-2022 <a href=/about>ntalbs</a></section><section class=poweredby>Powered by <a class=icon-ghost href=https://gohugo.io>Hugo</a></section></div></footer></body></html>