<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hexo: 소스 코드 하이라이팅 스타일 변경 @ntalbs&#39; stuff</title>
<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="stylesheet" href="/css/style.css">

  </head>
  <body>
    <div id="progress">
  <div id="bar"></div>
  <div class="container">
    <div id="scroll-title">Hexo: 소스 코드 하이라이팅 스타일 변경</div>
  </div>
</div>

    <nav class="navbar" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#nav-items">+</button>
      <a class="navbar-brand" href="/">@ntalbs&#39; stuff</a>
    </div>
    <div class="navbar-items collapsed" id="nav-items">
      <ul>
        
        <li><a href="/archive/">Archive</a></li>
        
        <li><a href="/tags/">Tags</a></li>
        
        <li><a href="/about/">About</a></li>
        
      </ul>
    </div>
  </div>
</nav>

<header class="page-head">
  <div class="container">
    <p class="blog-description">내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p>
  </div>
</header>

    <main class="container" role="main">
      <article class="post">
        <header>
          <p class="post-meta">
            <time datetime="2014-10-16" itemprop="datePublished">2014-10-16</time>
            on
            
            <a href="/tags/hexo/">Hexo</a>
            
          </p>
          <h1 class="post-title">
            Hexo: 소스 코드 하이라이팅 스타일 변경
          </h1>
        </header>
        <section class="post-content">
          <p>블로그 테마를 수정하면서 소스 코드 하이라이팅 스타일도 바꾸고 싶었다. 내 테마의 스타일은 <a href="http://learnboost.github.io/stylus/">stylus</a>로 되어 있는데, 파일을 살펴보니 중간에 다음과 같은 부분이 보였다.
</p>

<pre><code class="language-css">/* Theme: Solarized - Github
 * More theme here: http://softwaremaniacs.org/media/soft/highlight/test.html
 */
pre .comment,
pre .template_comment,
.diff pre .header,
pre .javadoc
  color #998
  font-style italic
...
</code></pre>

<p>이 부분에서 소스 코드 하이라이팅 스타일을 지정하는 것으로 보였다. 내가 색상을 일일히 편집할 수는 없으므로 다른 테마를 적용할 수 있을까 해서 브라우저로 주석에 나온 URL을 열어 보았다. 리디렉트 되어 <a href="https://highlightjs.org/">highlight.js</a>의 <a href="https://highlightjs.org/static/test.html">데모/테스트 페이지</a>가 열렸다. 마음에 드는 스타일을 골라 적용하면 되겠다 싶었다. highlight.js의 소스 코드는 <a href="https://github.com/isagalaev/highlight.js">https://github.com/isagalaev/highlight.js</a>에 있었고, 각 스타일에 대한 CSS 파일도 찾을 수 있었다. 마음에 드는 스타일 파일을 내 테마 디렉터리에 복사하고, 이 CSS를 블로그 페이지에서 참조하도록 수정했다.</p>

<p>그런데 문제가 있었다. CSS 파일을 살펴보니 모든 클래스에 <code>hljs-</code> 접두어가 붙어 있었다. 이래서는 CSS 파일만 추가해 소스 코드 하이라이팅 스타일을 바꿀 수 없었다. 구글에서 &lsquo;hexo hljs&rsquo;로 검색하니 <a href="https://github.com/hexojs/hexo/issues/434">관련 이슈</a>가 나왔는데, 여기서는 내용이 반대였다. 즉 highlight.js가 버전이 올라가면서 <code>hljs-</code> 접두어를 붙이는 바람에 기존 코드 스타일이 깨지니 접두어를 붙이지 않도록 설정하자는 것이었다. 그리고 그게 Hexo 소스(<code>lib/util/highlight.js</code>)에도 반영이 되어 있었다.</p>

<p>highlight.js의 기능과 스타일을 그대로 사용하기 위해 원래대로 돌려놓아야 했다. 생각해보니 Hexo는 node.js로 작성되었으니 소스 코드는 JavaScript 파일일테고, 내가 찾아 직접 수정할 수 있겠다는 생각이 들었다.</p>

<p>그래서 먼저 hexo가 설치된 디렉터리를 확인했다.</p>

<pre class="console">
$ which hexo
/usr/local/bin/hexo

$ ls -l /usr/local/bin/hexo
lrwxr-xr-x  1 ntalbs  admin  33  9 12 14:43 /usr/local/bin/hexo@ -> ../lib/node_modules/hexo/bin/hexo
</pre>

<p>내 시스템에서는 Hexo가 <code>/usr/local/lib/node_modules/hexo/</code>에 설치되어 있는 것을 확인할 수 있었다. 이제 <code>lib/util/highlight.js</code> 파일을 찾을 차례다.</p>

<pre class="console">
$ cd /usr/local/lib/node_modules/hexo/
$ ls
LICENSE       README.md     bin/          lib/          package.json
Makefile      assets/       gulpfile.js   node_modules/

$ cd lib
$ ls
box/     error/   hexo.js  loaders/ model/   post/    util/
core/    extend/  init.js  logger/  plugins/ theme/

$ cd util
$ ls
escape.js     file2.js      html_tag.js   permalink.js  spawn.js
exec.js       format.js     index.js      pool.js
file.js       highlight.js  inflector.js  server.js
</pre>

<p><code>/usr/local/lib/node_modules/hexo/lib/util</code>에 <code>highlight.js</code> 파일이 있었다. 파일을 열여 다음과 같이 수정했다. 어쩌면 <code>hljs.configure({...});</code>를 통째로 날려도 될지 모르겠다.</p>

<pre><code class="language-diff">  hljs.configure({
-  classPrefix: ''
+  classPrefix: 'hljs-'
  });
</code></pre>

<p>이렇게 수정한 다음 생성된 HTML을 확인했다. 스타일 CSS 파일에는 <code>.hljs</code> 클래스가 정의되어 있지만, 생성된 HTML에서는 <code>&lt;figure class=&quot;highlight&gt;</code>와 같이 되어 있었다.  <code>lib/util/highlight.js</code> 파일을 살표보니 <code>&lt;figure&gt;</code>에 <code>highlight</code> 클래스를 붙이는 부분이 있었다.</p>

<pre><code class="language-diff">-  var result = '&lt;figure class=&quot;highlight + (options.lang ? ' ' + options.lang : '') + '&quot;&gt;' +
+  var result = '&lt;figure class=&quot;hljs' + (options.lang ? ' ' + options.lang : '') + '&quot;&gt;' +
    (options.caption ? '&lt;figcaption&gt;' + options.caption + '&lt;/figcaption&gt;' : '');
</code></pre>

<p>다시 HTML을 생성해 확인했는데, 소스 코드에서 빈 줄이 있는 경우 달랑 <code>&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;</code>만 생성되어 빈 줄이 제대로 표현되지 않았다. 각 행을 렌더링하는 부분을 찾아 빈 줄인 경우 <code>&lt;div&gt;</code> 안에 <code>\ufeff</code>를 넣도록 수정했다.</p>

<pre><code class="language-diff">  lines.forEach(function(item, i){
    numbers += '&lt;div class=&quot;line&quot;&gt;' + (i + firstLine) + '&lt;/div&gt;';
-   content += '&lt;div class=&quot;line&quot;&gt;' + item + '&lt;/div&gt;';
+   content += '&lt;div class=&quot;line&quot;&gt;' + (item?item:'\ufeff') + '&lt;/div&gt;';
  });
</code></pre>

<p>이제 다 된 것 같아 블로그 HTML을 다시 생성해 브라우저에서 확인해 보았다. 잘 된 것 같은데 뭔가 빠진 것 같은 생각이 들었다. 자세히 살펴보니 <a href="https://highlightjs.org/static/test.html">https://highlightjs.org/static/test.html</a>에서 렌더링된 결과와 뭔가 달랐다. 확인해보니 Hexo가 사용하는 <code>highlight.js</code> 버전이 <code>8.1.0</code>이었다. Hexo의 <code>package.json</code> 파일을 편집해 <code>highlight.js</code> 최신 버전을 사용하게 했다.</p>

<pre><code class="language-diff">   &quot;dependencies&quot;: {
     ...
-    &quot;highlight.js&quot;: &quot;8.1.0&quot;,
+    &quot;highlight.js&quot;: &quot;8.3.0&quot;,
     ...
</code></pre>

<p>그리고 Hexo 설치 디렉터리에서 <code>npm update</code> 명령을 실행했다. <code>npm list</code>로 확인해보니 제대로 업데이트 된 것 같다. HTML을 생성해 확인해 보니 제대로 되어 있다. 내 테마 스타일 파일에서 소스 코드 스타일을 지정하는 부분은 더 이상 필요하지 않으므로 삭제해도 된다.</p>

<pre><code class="language-diff">- /* Theme: Solarized - Github
-  * More theme here: http://softwaremaniacs.org/media/soft/highlight/test.html
-  */
- pre .comment,
- pre .template_comment,
- .diff pre .header,
- pre .javadoc
-   color #998
-   font-style italic
  ...
</code></pre>

<p>이제 <code>highlight.js</code> 스타일을 가져다 마음껏 바꿀 수 있게 되었다. 다만 Hexo가 업데이트 되면 내가 수정한 내용도 날아갈테니 Hexo에 내가 수정한 내용을 Pull Request 해봐야 겠다.</p>
        </section>
        <footer class="post-footer">
          
          <div class="social button-box">
            
            <a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a>
            <a class="twitter-follow-button" href="https://twitter.com/ntalbs" data-show-count="false">Follow @ntalbs</a>
            <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
            
          </div>
          
          <nav id="article-nav">
            
            <a class="article-nav-link-wrap previous" href="https://ntalbs.github.io/2014/quicksort/" id="article-nav-newer"> 함수형 언어로 구현한 퀵정렬</a>
            
            
            <a class="article-nav-link-wrap next" href="https://ntalbs.github.io/2014/dba-story-5/" id="article-nav-older"> 초보 DBA 삽질기 5</a>
            
          </nav>
        </footer>
      </article>
    </main>
    
<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
    <script type="text/javascript">
     var disqus_shortname = 'ntalbs-stuff';
     (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


    <section class="section">
  <div class="container has-text-centered">
    <p></p>
  </div>
</section>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-2098194-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script src=https://ntalbs.github.io/js/index.js type="text/javascript"></script>

    <link rel="stylesheet" href="/css/github.css">
<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
   tex2jax: {
     inlineMath: [['$','$']],
     displayMath: [['$$','$$']],
     processEscapes: true,
     processEnvironments: true,
     skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
     TeX: { equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "AMSsymbols.js"] }
   }
 });
</script>

    <footer class="page-bottom">
  <div class="inner">
    <section class="copyright">© 2008-2018 <a href="/about">ntalbs</a></section>
    <section class="poweredby">Powered by <a class="icon-ghost" href="https://gohugo.io">Hugo</a></section>
  </div>
</footer>

  </body>
</html>
