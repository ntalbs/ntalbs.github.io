<!DOCTYPE html><html><head><meta name="google-site-verification" content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE"><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>정규 표현식을 이용한 찾기/바꾸기 시 카운터 사용 | ntalbs&#39; stuff</title><meta name="description" content=""><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="ntalbs' stuff"></head><body class="home-template"><nav class="navbar" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#nav-items">+</button> <a class="navbar-brand" href="/">@ntalbs' stuff</a></div><div class="navbar-items collapsed" id="nav-items"><ul><li><a href="/archives">Archives</a></li><li><a href="/tags">Tags</a></li><li><a href="/about">About</a></li></ul></div></div></nav><div id="progress"><div id="bar"></div><div class="container"><div id="scroll-title">정규 표현식을 이용한 찾기/바꾸기 시 카운터 사용</div></div></div><header class="site-head"><div class="container"><p class="blog-description">내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p></div></header><main class="container" role="main"><article class="post"><header><p class="post-meta"><time datetime="2014-12-05T00:00:00.000Z" itemprop="datePublished">2014-12-05</time> on <a href="/tags/Emacs/" style="margin:0 5px">Emacs</a><a href="/tags/정규표현식/" style="margin:0 5px">정규표현식</a></p><h1 class="post-title">정규 표현식을 이용한 찾기/바꾸기 시 카운터 사용</h1></header><section class="post-content"><p>반복된 패턴을 찾아 다른 문자열로 치환하고 싶을 때 정규 표현식을 사용하면 편리하다. 지금까지는 정규 표현식을 사용해 문자를 치환할 때 고정된 패턴만 지정할 수 있다고 생각했다. 그래서 스택오어플로우에서 정규 표현식으로 문자열을 치환할 때 카운터(counter)를 사용할 수 있냐는 질문을 봤을 때 ‘되지도 않는 질문’이라 속단했다.<a id="more"></a></p><p>그러나 정규 표현식으로 문자열을 치환할 때 카운터를 사용하는 방법이 있었다. <a href="http://stackoverflow.com/questions/5942360/gvim-find-replace-with-counter" target="_blank" rel="external">gVim find/replace with counter</a>에 Vim에서 정규 표현식 사용 시 카운터를 사용하는 방법이 나와 있다. Emacs에서는 어떻게 할까 궁금해 구글에서 <code>emacs regexp counter</code>로 검색해 봤는데, 쉽게 방법을 찾을 수 있었다.</p><h2 id="문제"><a href="#문제" class="headerlink" title="문제"></a>문제</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>lorem<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ipsum<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>dolor<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>위와 같은 텍스트를 정규 표현식을 사용해 다음과 같이 바꿀 수 있을까?</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"1"</span>&gt;</span>lorem<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"2"</span>&gt;</span>ipsum<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"3"</span>&gt;</span>dolor<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="query-replace-regexp"><a href="#query-replace-regexp" class="headerlink" title="query-replace-regexp"></a>query-replace-regexp</h2><p>Emacs의 정규 표현식 치환 명령인 <code>query-replace-regexp</code>를 사용할 때는 치환 문자열에서 <code>\#</code>로 카운터를 지정할 수 있다. 위 경우라면 다음과 같이 할 수 있겠다.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">M-x query-replace-regexp RET &lt;p&gt; RET &lt;p id=&quot;\#&quot;&gt; RET</span><br></pre></td></tr></table></figure><p><code>C-M-%</code> 단축키를 사용해도 된다. <code>\#</code>는 0부터 시작하는데, 이를 조정하는 방법은 알아내지 못했다.</p><h2 id="query-replace-regexp-eval"><a href="#query-replace-regexp-eval" class="headerlink" title="query-replace-regexp-eval"></a>query-replace-regexp-eval</h2><p><code>query-replace-regexp-eval</code>을 이용하면 대치할 문자열에 Lisp 표현식을 사용할 수 있다. 조금 번거롭지만 막강한 기능이라 할 수 있다. 치환 시 카운터는 <code>replace-count</code> 변수에 바인드된다. 위 문제는 다음과 같이 간단히 풀 수 있다.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">M-x query-replace-regexp-eval RET &lt;p&gt; RET (format &quot;&lt;p id=\&quot;%d\&quot;&gt;&quot; replace-count) RET</span><br></pre></td></tr></table></figure><p><code>(format ...)</code>은 Lisp 함수를 호출하는 것이다. C의 <code>printf</code> 함수 사용법과 거의 비슷한 것 같다. <code>%s</code>는 문자열 인자를, <code>%d</code>는 정수 인자를 받는 식이다. <code>query-replace-regexp</code>를 썼을 때와 마찬가지로 <code>replace-count</code> 역시 0부터 시작한다. 그러나 여기서는 대치할 문자열로 Lisp 표현식을 사용했으므로 이 부분을 다음과 같이 수정해 1부터 시작하도록 바꿀 수 있다.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">... RET (format &quot;&lt;p id=\&quot;%d\&quot;&gt;&quot; (+ replace-count 1)) RET</span><br></pre></td></tr></table></figure><p><code>replace-count</code> 자리에 <code>\#</code>을 써도 된다.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">... RET (format &quot;&lt;p id=\&quot;%d\&quot;&gt;&quot; (+ \# 1)) RET</span><br></pre></td></tr></table></figure><h2 id="Visual-regexp-steroides를-사용하는-경우"><a href="#Visual-regexp-steroides를-사용하는-경우" class="headerlink" title="Visual-regexp-steroides를 사용하는 경우"></a>Visual-regexp-steroides를 사용하는 경우</h2><p><a href="https://github.com/benma/visual-regexp.el" target="_blank" rel="external">visual-regexp</a>와 <a href="https://github.com/benma/visual-regexp-steroids.el/" target="_blank" rel="external">visual-regexp-steroids</a>를 사용하면 정규 표현식에 매치되는 텍스트와 치환될 텍스트가 버퍼에 즉시 표시되므로 문자열 치환 작업을 좀더 쉽게 수행할 수 있다. visual-regexp-steroids에서는 <code>i</code>가 카운터 변수다.</p><p><code>vr/replace</code>(<code>C-c r</code>)를 실행해 찾을 문자열을 입력한 다음 <code>RET</code> 하면 치환할 문자열을 입력할 수 있다. 이때 <code>C-c C-c</code>를 눌러 수식 입력 모드로 바꾼 다음 다음과 같은 식으로 수식을 입력할 수 있다.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&lt;p id=\&quot;&quot;+str(i+1)+&quot;\&quot;&gt;&quot;</span><br></pre></td></tr></table></figure><p>수식 입력 모드에서는 입력 내용이 수식으로 인식된다. 문자열을 <code>&quot;</code>로 감싸줘야 하므로 입력하는 내용이 조금 지저분해진다. 매치되는 텍스트와 치환될 텍스트가 버퍼에 바로 표시되는 점을 고려한다면 이 정도 불편은 충분히 감수할 수 있을 것이다.</p><h2 id="참고자료"><a href="#참고자료" class="headerlink" title="참고자료"></a>참고자료</h2><ul><li><a href="http://www.emacswiki.org/emacs/ReplaceCount" target="_blank" rel="external">ReplaceCount</a><br>Emacs에서 정규 표현식 치환 시 카운터를 사용하는 방법</li><li><a href="https://github.com/benma/visual-regexp-steroids.el/" target="_blank" rel="external">visual-regexp-steroids</a><br>visual-regexp-steroids에서 정규 표현식 치환 시 카운터를 사용하는 방법. README.md의 마지막 부분에 수식 사용 예제가 있음</li><li><a href="http://stackoverflow.com/questions/27308231/using-a-regular-expression-in-vim-how-do-i-replace-the-asterisks-of-an-unordere" target="_blank" rel="external">Using a regular expression in VIM, how do I replace the asterisks of an unordered list with numbers?</a><br>스택오버플로우에서 발견한 질문. 다른 질문과 중복 처리됨</li><li><a href="http://stackoverflow.com/questions/5942360/gvim-find-replace-with-counter" target="_blank" rel="external">gVim find/replace with counter</a><br>Vim에서 정규 표현식 치환 시 카운터를 사용하는 방법에 대한 질문과 대답</li><li><a href="/2014/visual-regexp/">visual-regexp</a></li></ul></section><footer class="post-footer"><nav id="article-nav"><a href="/2014/multiple-jdk-on-macosx/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title">MacOS X에서 JDK 버전 전환</span> </a><a href="/2014/mysql-row-generator/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">MySQL Row Generator</span></a></nav><section id="comment"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></footer></article></main><footer class="site-footer"><div class="inner"><section class="copyright">&copy; 2008-2015 <a href="/about">ntalbs</a></section><section class="poweredby">Powered by <a class="icon-ghost" href="http://hexo.io">Hexo</a></section></div></footer><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script type="text/javascript" src="/js/jquery.fitvids.js"></script><script type="text/javascript" src="/js/index.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>!function(e,a,t,n,c,s,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,s=a.createElement(t),o=a.getElementsByTagName(t)[0],s.async=1,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-2098194-3","auto"),ga("require","displayfeatures"),ga("send","pageview")</script><script type="text/javascript">var disqus_shortname="ntalbs-stuff";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>