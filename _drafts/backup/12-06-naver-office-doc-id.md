tags:
date: 2014-12-06
title: 네이버 오피스 문서 아이디 문제점
---
구글 독스로 만든 문서 중 자주 사용하는 문서는 북마크를 해둔다. 문서를 봐야 할 경우 북마크를 통해 문서를 바로 열 수 있어 매우 편리하다. 혹시 문서의 이름을 바꾸거나 다른 폴더로 옮겨도 문서에 대한 URL은 변하지 않으므로 북마크를 다시 만들 필요가 없다. 네이버 오피스에서는 어떨가? 로그인만 해두면 구글 독스와 마찬가지로 문서에 대한 북마크를 만들어 사용할 수 있을 것 같아 보인다. 문서의 이름을 바꾸거나 저장 위치를 바꾸지만 않는다면, 문서를 자주 열어보기만 한다면 말이다.<!--more-->

네이버 오피스는 문서에 대한 고유 주소(permalink)를 제공하지 않는다. 문서를 열었을 때 브라우저 주소창에 표시되는 URL은, 그 URL에 포함된 문서 아이디(docId)는 임시로 사용될 뿐이다. 다음과 같은 경우 문서 아이디가 바뀐다.

* 파일 이름을 바꾸는 경우
* 파일을 다른 폴더로 이동하는 경우
* 일정 기간 이상 문서에 접근하지 않은 경우. 이후 동일 문서를 열면 그때 문서 아이디를 다시 생성한다.

문서를 열어둔 상태에서 다른 창에서 N드라이브에 접근해 파일 이름을 변경하면 어떻게 될까? 열려 있는 문서와 N드라이브 파일과의 관계가 끊어진다. 열려 있는 문서를 저장한 다음 N드라이브에서 확인하면 변경하기 전 이름으로 새로운 파일이 새로 생겨 있다. N드라이브에서 이름을 변경한 파일을 웹 오피스로 열어보면 문서 아이디가 전과 다른 것을 확인할 수 있다.

네이버 오피스는 왜 구글 독스처럼 만들지 못했을까? 나름 사연이 있다. 네이버 오피스를 만들때 문서 저장소로 N드라이브를 사용해야 했다. 우리는 네이버 오피스와 N드라이브는 별개 서비스라 생각했다. 그러나 네이버는 오피스를 N드라이브의 하위 서비스라 생각했고, 문서 저장소로 N드라이브를 사용하도록 강제했다. 제한된 기간 안에 독자적인 문서 저장소를 만드는 것은 위험 부담이 컸고, 네이버에서 허용하지도 않았다.

문제는 N드라이브가 파일에 대한 유일한 아이디를 제공하지 않는다는 점이었다. 우리는 여러 차례 파일에 대한 유일한 아이디를 제공해달라고 네이버에 요청했지만 네이버는 오피스 때문에 N드라이브를 수정할 수 없다는 입장을 고수했다. 결국 N드라이브 경로를 기준으로 문서 아이디를 만들 수밖에 없었다. 이런 이유로 위와 같은 문제가 생긴 것이다.

N드라이브 경로를 이용해 문서 아이디를 만든다면 경로가 바뀔때마다 문서 아이디도 바뀔 수밖에 없다. 문서 파일의 경로가 바뀔 경우 N드라이브에서 이 사실을 오피스에 알려준다면 문서 아이디를 유지할 수 있을지도 모른다. 그러나 네이버에서는 그런 기능을 제공할 계획이 없다고 했다.

게다가 일정 기간 문서에 접근하지 않으면 문서 아이디가 삭제된다니, 이건 또 무슨 소린가? 네이버 오피스는 문서 아이디와 N드라이브 경로를 매핑하는 정보를 데이터베이스에 유지한다. 그런데 이 매핑 테이블 크기가 무한정 늘어나도록 놔둘 수 없으므로 일정 기간 접근되지 않은 문서에 대한 매핑 정보를 삭제한다. 매핑 정보가 삭제된 문서를 열면 문서 아이디가 다시 생성된다. 물론 이때 생성된 문서 아이디는 예전의 문서 아이디와는 다를 것이다.

혹시 N드라이브 경로를 인자로 받는 문서 아이디 생성 함수 같은 것을 만들었다면 이런 문제를 회피할 수 있지 않았을까?

{% codeblock lang:java %}
String docId = createDocId(ndrivePath);
...
{% endcodeblock %}

그럼 새 문서를 만드는 경우는 어떻게 해야 할까? 아직 N드라이브에 저장하지 않았는데 어떻게 경로를 넣어줄 수 있을까? 구글 독스는 새 문서를 만들면 최상위 폴더에 `Untitled document`란 이름의 문서를 만든다. 우리도 이런 방식을 사용할 수 있지만, 네이버 생각은 달랐다. 사용자가 아직 저장하지도 않은 문서가 N드라이브에 파일로 생기는 것은 허용하지 않았다. 네이버는 MS 오피스를 그대로 웹 환경으로 옮겨놓은 웹 오피스를 원했다. 파일 메타포어(metaphor)를 그대로 유지하고 싶어 했다.

이런 단점에 불만을 제기한 사용자는 없었다. 그러나 네이버 폼을 만들 때 문제가 되었다. 폼은 특성상 문서에 대한 URL을 불특정 다수에게 보내야 하는데, 이렇게 URL을 공개한 다음 문서 이름은 바꾸거나 다른 폴더로 이동하면 공유한 URL로 문서에 접근할 수 없게 되고 만다. 그제서야 심각성을 인식한 네이버는 파일에 대한 유일한 아이디를 얻는 방법을 가르쳐 주었다.

아마 네이버 내부 사정이 있었을 것이다. 유일한 아이디를 얻는 방법이 처음에는 없었다거나, 사용하면 안 될 다른 이유가 있었을지도 모른다. 그러나, 네이버가 좀더 열린 자세로 우리와 협업했다면 네이버 오피스 구조가 지금보다 훨씬 나아졌을 것이란 아쉬움이 남는다.

## 참고
* [ndoc의 유래](/2014/10/15/origin-of-ndoc/)
