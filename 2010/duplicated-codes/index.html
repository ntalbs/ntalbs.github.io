<!DOCTYPE html><html><head><meta name="google-site-verification" content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE"><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>코드 중복과 보이스카우트 규칙 | ntalbs&#39; stuff</title><meta name="description" content=""><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="ntalbs' stuff"></head><body class="home-template"><nav class="navbar" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#nav-items">+</button> <a class="navbar-brand" href="/">@ntalbs' stuff</a></div><div class="navbar-items collapsed" id="nav-items"><ul><li><a href="/archives">Archives</a></li><li><a href="/tags">Tags</a></li><li><a href="/about">About</a></li></ul></div></div></nav><div id="progress"><div id="bar"></div><div class="container"><div id="scroll-title">코드 중복과 보이스카우트 규칙</div></div></div><header class="site-head"><div class="container"><p class="blog-description">내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p></div></header><main class="container" role="main"><article class="post"><header><p class="post-meta"><time datetime="2010-05-15T23:00:00.000Z" itemprop="datePublished">2010-05-16</time> on <a href="/tags/리팩터링/" style="margin:0 5px">리팩터링</a></p><h1 class="post-title">코드 중복과 보이스카우트 규칙</h1></header><section class="post-content"><blockquote class="blockquote-reverse">캠핑 장은 처음 왔을 때보다 더 깨끗하게 해놓고 떠나라!<br>보이스카우트 규칙 (클린 코드, p50)<br></blockquote><p>때로는 아주 사소한 코드 중복이 큰 문제를 만드는 경우도 있다.</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> fnCallback = $Fn(<span class="function"><span class="keyword">function</span>(<span class="params">bSuccess, sMessage, oData</span>) </span>&#123;</div><div class="line">  <span class="comment">//...</span></div><div class="line">  <span class="keyword">if</span> (acrobat.isInstalled) &#123;</div><div class="line">      <span class="keyword">this</span>.printUrl = oData.redirectURL + <span class="string">"&amp;isSilent=true"</span>;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">this</span>.printUrl = oData.redirectURL;</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="keyword">this</span>).bind();</div></pre></td></tr></table></figure><p>중복 코드에 민감한 개발자라면 당장에 중복된 부분이 눈에 들어올 것이다. 4째 줄과 6째 줄에 <code>this.printUrl = oData.redirectURL</code> 부분이 중복이다. 단순한 코드라서 언듯 보기에는 별 문제가 없어 보일는지 모르겠다. 그러나 꼭 그렇지만은 않다. <strong>문제가 생길 가능성이 있다면 꼭 문제가 생긴다.</strong> 결과가 심각할수록 발생할 확율도 높아지는 것 같다.<br><a id="more"></a></p><p>얼마 전 일이다. 퇴근하려고 하는데 갑자기 개발자가 달려왔다. 자기 자리에서는 잘 동작하는 기능이 다른 사람 자리에서는 안 된다는 것이다. 보통 이런 현상은 PC마다 환경이 조금이라도 다르기 때문에 발생한다는 것쯤은 예상할 수 있었지만, 이건 웹 프로그램이었고 어떤 차이 때문에 PC마다 다른 현상이 발생하는지 감을 잡을 수 없었다.</p><p>한참을 헤매다가 확인한 것은 어도비 리더가 설치된 PC에서는 제대로 동작하지 않고 어도비 리더가 설치되지 않은 PC에서는 제대로 동작한다는 것을 알게 되었다. 소스 코드에서 어도비 리더가 설치되어 있는지를 확인해 다르게 분기하는 부분을 찾았 확인했다. 앞에서 본 코드인데, 약간 수정되어 있었다.</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> fnCallback = $Fn(<span class="function"><span class="keyword">function</span>(<span class="params">bSuccess, sMessage, oData</span>) </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  <span class="keyword">if</span> (acrobat.isInstalled) &#123;</div><div class="line">    <span class="keyword">this</span>.printUrl = <span class="keyword">this</span>.serverLocation</div><div class="line">        + <span class="string">"/"</span> + oData.redirectURL + <span class="string">"&amp;isSilent=true"</span>;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    $(<span class="string">"hidden_download_frame"</span>).setAttribute(<span class="string">"src"</span>, oData.redirectURL );</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="keyword">this</span>).bind();</div></pre></td></tr></table></figure><p>즉, 어도비 리더가 설치된 경우에 동작하는 코드에서는 <code>this.printUrl</code> 앞에 <code>this.serverLocation + &quot;/&quot;</code>가 붙어있지만 어도비 리더가 설치되지 않은 경우에 동작하는 코드 브랜치에는 그렇지 않았다. 누군가 어떤 문제를 해결하기 위해 <code>this.printUrl</code> 앞에 <code>this.serverLocation + &quot;/&quot;</code>를 붙이도록 했는데 <code>if</code> 문의 양쪽 브랜치를 수정하지 않고 한쪽만 수정했다. 그리고 어도비 리더가 설치된 환경에서만 테스트를 했을 것이다. 다른 개발자는 서버쪽에서 또다른 작업을 한 다음, 어도비 리더가 설치되지 않은 환경에서만 테스트를 해보고는 제대로 돌아간다고 생각했을 것이다. 결국 이 부분에서 문제가 터졌다.</p><p><strong>애초에 문제를 유발한 것은 거의 비슷한 코드가 두 곳에 있었다는 것이다.</strong> 이런 경우 대부분 한 곳이 바뀌면 다른 곳도 함께 바뀌어야 한다. 그러나 개발자가 한 쪽을 수정하면서 다른 쪽은 수정하지 않아 문제가 발생핬다. 급하게 수정하다보면 이런 일이 많지만, 이 부분을 수정한 개발자가 <strong>보이스카우트 규칙</strong>에 따라 자신이 수정한 부분을 깔끔하게 정리했더라면 이런 삽질은 없었을 것이다.</p><p>최근에 코드를 다시 살펴보니 원래의 모습으로 돌아가 있다. 그러나 마음에 들지 않는다. 다음과 같은 식이 낫지 않을까?</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> fnCallback = $Fn(<span class="function"><span class="keyword">function</span>(<span class="params">bSuccess, sMessage, oData</span>) </span>&#123;</div><div class="line">  <span class="comment">//...</span></div><div class="line">  <span class="keyword">this</span>.printUrl = oData.redirectURL</div><div class="line">      + ((acrobat.isInstalled)?<span class="string">"&amp;isSilent=true"</span>:<span class="string">""</span>);</div><div class="line">&#125;, <span class="keyword">this</span>).bind();</div></pre></td></tr></table></figure><p>개발자라면 코드를 수정할 때 자신의 작업이 어디까지 영향을 미치는지 확인해야 한다. <strong>그리고 수정하는 부분과 그 주변 코드를 깔끔하게 정리해야 한다. 작업하기 전보다 더 깔끔하게 정리해야 한다. 특히 중복된 코드가 눈에 띄면 반드시 제거해야 한다.</strong> 약간의 시간을 들여 정리를 해두면 위 경우처럼 나중에 헤메는 것을 방지할 수 있다.</p><div class="button-box"><a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a> <a class="twitter-follow-button" href="https://twitter.com/ntalbs" data-show-count="false">Follow @ntalbs</a></div></section><footer class="post-footer"><nav id="article-nav"><a href="/2010/recover-db-no-archivelog-mode/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title">noarchivelog mode에서의 복구</span> </a><a href="/2010/id-2/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">아이디 2</span></a></nav><section id="comment"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></footer></article></main><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><footer class="site-footer"><div class="inner"><section class="copyright">&copy; 2008-2015 <a href="/about">ntalbs</a></section><section class="poweredby">Powered by <a class="icon-ghost" href="http://hexo.io">Hexo</a></section></div></footer><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script type="text/javascript" src="/js/jquery.fitvids.js"></script><script type="text/javascript" src="/js/index.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>!function(e,a,t,n,c,s,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,s=a.createElement(t),o=a.getElementsByTagName(t)[0],s.async=1,s.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(s,o)}(window,document,"script",0,"ga"),ga("create","UA-2098194-3","auto"),ga("require","displayfeatures"),ga("send","pageview")</script><script type="text/javascript">var disqus_shortname="ntalbs-stuff";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>