<!DOCTYPE html><html><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-2098194-3"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-2098194-3');</script><meta charset="utf-8"><meta name="google-site-verification" content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE"><meta name="viewport" content="width=device-width,initial-scale=1"><title>PostgreSQL 날짜 연산 @ntalbs' stuff</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"></head><body><div id="progress"><div id="bar"></div><div class="container"><div id="scroll-title">PostgreSQL 날짜 연산</div></div></div><nav class="navbar" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle unselectable" data-toggle="collapse" data-target="#nav-items">+</button>
<a class="navbar-brand unselectable" href="/">@ntalbs' stuff</a></div><div class="navbar-items collapsed" id="nav-items"><ul><li><a class="unselectable" href="/archive/">Archive</a></li><li><a class="unselectable" href="/tags/">Tags</a></li><li><a class="unselectable" href="/about/">About</a></li></ul></div></div></nav><header class="page-head"><div class="container"><p class="blog-description">내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p></div></header><main class="container" role="main"><article class="post"><header><p class="post-meta"><time datetime="2010-07-09" itemprop="datePublished">2010-07-09</time>
on
<a href="/tags/db/">DB</a>
<a href="/tags/postgresql/">PostgreSQL</a>
<a href="/tags/sql/">SQL</a></p><h1 class="post-title">PostgreSQL 날짜 연산</h1></header><section class="post-content"><p>database.sarang.net의 <a href="http://database.sarang.net/?criteria=pgsql">PostgreSQL 게시판</a>에 PostgreSQL에서 <a href="http://database.sarang.net/?inc=read&amp;aid=8678&amp;criteria=pgsql&amp;subcrit=qna&amp;id=&amp;limit=20&amp;keyword=&amp;page=1">날짜 연산 관련 질문</a>이 올라왔다. 답을 생각해보면서 PostgreSQL에서 날짜 관련 함수 및 연산 방법을 간단히 정리해봤다.</p><h2 id="------">간단한 날짜 관련 함수 및 날짜 연산:</h2><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:green">-- 오늘 (date)
</span><span style="color:green"></span><span style="color:#00f">select</span> <span style="color:#00f">current_date</span>;

<span style="color:green">-- 현재시각 (timestamp)
</span><span style="color:green"></span><span style="color:#00f">select</span> now();
<span style="color:#00f">select</span> <span style="color:#00f">current_timestamp</span>;

<span style="color:green">-- 어제/오늘/내일
</span><span style="color:green"></span><span style="color:#00f">select</span>
  <span style="color:#00f">current_date</span> - 1 <span style="color:#a31515">"</span><span style="color:#a31515">어제</span><span style="color:#a31515">"</span>,
  <span style="color:#00f">current_date</span>     <span style="color:#a31515">"</span><span style="color:#a31515">오늘</span><span style="color:#a31515">"</span>,
  <span style="color:#00f">current_date</span> + 1 <span style="color:#a31515">"</span><span style="color:#a31515">내일</span><span style="color:#a31515">"</span>
;

<span style="color:green">-- day of week
</span><span style="color:green"></span><span style="color:#00f">select</span> <span style="color:#00f">extract</span>(dow <span style="color:#00f">from</span> <span style="color:#00f">current_date</span>);    <span style="color:green">-- 일요일(0) ~ 토요일(6)
</span><span style="color:green"></span><span style="color:#00f">select</span> <span style="color:#00f">extract</span>(isodow <span style="color:#00f">from</span> <span style="color:#00f">current_date</span>); <span style="color:green">-- 월요일(1) ~ 일요일(7)
</span><span style="color:green"></span>
<span style="color:green">-- day of year
</span><span style="color:green"></span><span style="color:#00f">select</span> <span style="color:#00f">extract</span>(doy <span style="color:#00f">from</span> <span style="color:#00f">current_date</span>);

<span style="color:green">-- week of year
</span><span style="color:green"></span><span style="color:#00f">select</span> <span style="color:#00f">extract</span>(week <span style="color:#00f">from</span> <span style="color:#00f">current_date</span>);

<span style="color:green">-- 두 날짜 사이의 날수
</span><span style="color:green"></span><span style="color:#00f">select</span> <span style="color:#a31515">'</span><span style="color:#a31515">2010-07-05</span><span style="color:#a31515">'</span>::date - <span style="color:#a31515">'</span><span style="color:#a31515">2010-06-25</span><span style="color:#a31515">'</span>::date;
</code></pre></div><h2 id="-----">한 주의 첫날, 마지막 날 구하기:</h2><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:green">-- (주 첫 날을 월요일로 할 때 주) 첫날, 마지막 날
</span><span style="color:green"></span><span style="color:green">-- date_trunc() 함수의 리턴 타입은 timestamp임
</span><span style="color:green"></span>
<span style="color:green">-- 이번 주
</span><span style="color:green"></span><span style="color:#00f">select</span>
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>)::date     <span style="color:#a31515">"</span><span style="color:#a31515">이번 주 첫날</span><span style="color:#a31515">"</span>,
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>)::date+6   <span style="color:#a31515">"</span><span style="color:#a31515">이번 주 마지막 날</span><span style="color:#a31515">"</span>
;

<span style="color:green">-- 전 주
</span><span style="color:green"></span><span style="color:#00f">select</span>
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>-7)::date   <span style="color:#a31515">"</span><span style="color:#a31515">전 주 첫날</span><span style="color:#a31515">"</span>,
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>-7)::date+6 <span style="color:#a31515">"</span><span style="color:#a31515">전주 마지막 날</span><span style="color:#a31515">"</span>
;

<span style="color:green">-- 다음 주
</span><span style="color:green"></span><span style="color:#00f">select</span>
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>+7)::date   <span style="color:#a31515">"</span><span style="color:#a31515">다음 주 첫날</span><span style="color:#a31515">"</span>,
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>+7)::date+6 <span style="color:#a31515">"</span><span style="color:#a31515">다음주 마지막 날</span><span style="color:#a31515">"</span>
;

<span style="color:green">-- (주 첫 날을 일요일로 할 때) 주 첫날/마지막 날
</span><span style="color:green"></span><span style="color:green">-- week로 date_trunc를 하는 경우 결과가 월요일 날짜가 되기 때문에
</span><span style="color:green"></span><span style="color:green">-- 한 주를 일요일~토요일까지로 하는 경우는 -1 필요
</span><span style="color:green"></span>
<span style="color:green">-- 이번 주
</span><span style="color:green"></span><span style="color:#00f">select</span>
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>)::date-1     <span style="color:#a31515">"</span><span style="color:#a31515">이번 주 첫날</span><span style="color:#a31515">"</span>,
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>)::date+6-1   <span style="color:#a31515">"</span><span style="color:#a31515">이번 주 마지막 날</span><span style="color:#a31515">"</span>
;

<span style="color:green">-- 전 주
</span><span style="color:green"></span><span style="color:#00f">select</span>
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>-7)::date-1   <span style="color:#a31515">"</span><span style="color:#a31515">전 주 첫날</span><span style="color:#a31515">"</span>,
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>-7)::date+6-1 <span style="color:#a31515">"</span><span style="color:#a31515">전주 마지막 날</span><span style="color:#a31515">"</span>
;

<span style="color:green">-- 다음 주
</span><span style="color:green"></span><span style="color:#00f">select</span>
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>+7)::date-1   <span style="color:#a31515">"</span><span style="color:#a31515">다음 주 첫날</span><span style="color:#a31515">"</span>,
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>+7)::date+6-1 <span style="color:#a31515">"</span><span style="color:#a31515">다음주 마지막 날</span><span style="color:#a31515">"</span>
;
</code></pre></div><h2 id="-----1">한 달의 첫날, 마지막 날 구하기:</h2><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:green">-- 한 달 전/후 날짜
</span><span style="color:green"></span><span style="color:#00f">select</span>
  <span style="color:#00f">current_date</span> - interval <span style="color:#a31515">'</span><span style="color:#a31515">1 months</span><span style="color:#a31515">'</span> <span style="color:#a31515">"</span><span style="color:#a31515">전 달</span><span style="color:#a31515">"</span>,
  <span style="color:#00f">current_date</span> + interval <span style="color:#a31515">'</span><span style="color:#a31515">1 months</span><span style="color:#a31515">'</span> <span style="color:#a31515">"</span><span style="color:#a31515">다음 달</span><span style="color:#a31515">"</span>
;

<span style="color:green">-- 이번 달 첫날, 마지막 날
</span><span style="color:green"></span><span style="color:#00f">select</span>
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>,
             <span style="color:#00f">current_date</span>)::date <span style="color:#a31515">"</span><span style="color:#a31515">첫날</span><span style="color:#a31515">"</span>,
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>,
             <span style="color:#00f">current_date</span> + interval <span style="color:#a31515">'</span><span style="color:#a31515">1 months</span><span style="color:#a31515">'</span>)::date - 1 <span style="color:#a31515">"</span><span style="color:#a31515">마지막 날</span><span style="color:#a31515">"</span>
;

<span style="color:green">-- 전달 첫날, 마지막 날
</span><span style="color:green"></span><span style="color:#00f">select</span>
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>,
             <span style="color:#00f">current_date</span> - interval <span style="color:#a31515">'</span><span style="color:#a31515">1 months</span><span style="color:#a31515">'</span>)::date <span style="color:#a31515">"</span><span style="color:#a31515">첫 날</span><span style="color:#a31515">"</span>,
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>,
             <span style="color:#00f">current_date</span>)::date - 1 <span style="color:#a31515">"</span><span style="color:#a31515">마지막 날</span><span style="color:#a31515">"</span>
;

<span style="color:green">-- 다음 달 첫날, 마지막 날
</span><span style="color:green"></span><span style="color:#00f">select</span>
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>,
             <span style="color:#00f">current_date</span> + interval <span style="color:#a31515">'</span><span style="color:#a31515">1 months</span><span style="color:#a31515">'</span>)::date <span style="color:#a31515">"</span><span style="color:#a31515">첫 날</span><span style="color:#a31515">"</span>,
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>,
             <span style="color:#00f">current_date</span> + interval <span style="color:#a31515">'</span><span style="color:#a31515">2 months</span><span style="color:#a31515">'</span>)::date - 1 <span style="color:#a31515">"</span><span style="color:#a31515">마지막 날</span><span style="color:#a31515">"</span>
;
</code></pre></div><h2 id="-----2">이번 주 첫날부터 마지막 날까지 날짜들:</h2><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:green">-- 이번 주 날짜
</span><span style="color:green"></span><span style="color:#00f">select</span>
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>)::date -1 + i <span style="color:#a31515">"</span><span style="color:#a31515">일~토</span><span style="color:#a31515">"</span>,
  date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">week</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>)::date    + i <span style="color:#a31515">"</span><span style="color:#a31515">월~일</span><span style="color:#a31515">"</span>
<span style="color:#00f">from</span> generate_series(0,6) <span style="color:#00f">as</span> t(i);
</code></pre></div><h2 id="-----3">이번 달 첫날부터 마지막 날까지 날짜들:</h2><p><code>generate_series()</code> 함수를 사용한다. 한 달이 28일, 29일, 30일, 31일 중 어떤 것이 될지 알 수 없기 때문에 월의 마지막날을 구해 <code>generate_series()</code>의 두번째 인수로 넣어준다.</p><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:green">-- 이번 달 날짜 (첫날 ~ 마지막 날)
</span><span style="color:green"></span><span style="color:#00f">select</span> date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>)::date + (i - 1)
<span style="color:#00f">from</span>
  generate_series(
    1,
    <span style="color:#00f">extract</span>(<span style="color:#00f">day</span> <span style="color:#00f">from</span> date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span> + interval <span style="color:#a31515">'</span><span style="color:#a31515">1 months</span><span style="color:#a31515">'</span>)::date - 1)::integer
  ) <span style="color:#00f">as</span> t(i);

<span style="color:#00f">select</span> date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>)::date + (i - 1)
<span style="color:#00f">from</span>
  generate_series(
    1,
    <span style="color:#00f">extract</span>(<span style="color:#00f">day</span> <span style="color:#00f">from</span> date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>) + interval <span style="color:#a31515">'</span><span style="color:#a31515">1 months</span><span style="color:#a31515">'</span> - interval <span style="color:#a31515">'</span><span style="color:#a31515">1 days</span><span style="color:#a31515">'</span>)::integer
  ) <span style="color:#00f">as</span> t(i);
</code></pre></div><h2 id="week-of-month">week of month:</h2><p>이번 달의 첫날부터 마지막 날까지의 날짜와 week of month를 구하는 쿼리인데, 1일~7일까지는 첫째 주, 8일~14일까지는 둘째 주와 같은 식으로 된다. 역시 <code>generate_series()</code> 함수를 사용했다. 위와 같이 첫 날과 마지막 날의 차를 구해 수열을 만들지 않고, 0~30까지 만들어 무조건 더하면서 이번 달에 속하는 날짜만 <code>WHERE</code> 조건으로 추려내게 했다.</p><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00f">select</span> dt, to_char(dt, <span style="color:#a31515">'</span><span style="color:#a31515">W</span><span style="color:#a31515">'</span>) <span style="color:#a31515">"</span><span style="color:#a31515">day of week</span><span style="color:#a31515">"</span>
<span style="color:#00f">from</span> (
    <span style="color:#00f">select</span> date_trunc(<span style="color:#a31515">'</span><span style="color:#a31515">month</span><span style="color:#a31515">'</span>, <span style="color:#00f">current_date</span>)::date + i dt
    <span style="color:#00f">from</span> generate_series(0, 30) <span style="color:#00f">as</span> t(i)
    ) t
<span style="color:#00f">where</span> <span style="color:#00f">extract</span>(<span style="color:#00f">month</span> <span style="color:#00f">from</span> dt) = <span style="color:#00f">extract</span>(<span style="color:#00f">month</span> <span style="color:#00f">from</span> <span style="color:#00f">current_date</span>)
;
</code></pre></div><h2 id="postgresql---url">PostgreSQL 매뉴얼 참조 URL:</h2><p><a href="http://www.postgresql.org/docs/8.4/interactive/functions-datetime.html">http://www.postgresql.org/docs/8.4/interactive/functions-datetime.html</a>
<a href="http://www.postgresql.org/docs/8.4/interactive/functions-formatting.html">http://www.postgresql.org/docs/8.4/interactive/functions-formatting.html</a></p></section><footer class="post-footer"><div class="social button-box"><a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a>
<a class="twitter-follow-button" href="https://twitter.com/ntalbs" data-show-count="false">Follow @ntalbs</a>
<script async="" src="//platform.twitter.com/widgets.js"></script></div><nav id="article-nav"><a class="article-nav-link-wrap previous" href="https://ntalbs.github.io/2010/sql-loader/" id="article-nav-newer">SQL*Loader 사용법 (초간단 정리)</a>
<a class="article-nav-link-wrap next" href="https://ntalbs.github.io/2010/outliers/" id="article-nav-older">아웃라이어</a></nav></footer></article></main><section class="section"><div class="container"><aside><div id="disqus_thread"></div></aside><script type="text/javascript">var disqus_shortname='ntalbs-stuff';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class="section"><div class="container has-text-centered"><p></p></div></section><script src="https://ntalbs.github.io/js/index.js" type="text/javascript"></script><footer class="page-bottom"><div class="inner"><section class="copyright">© 2008-2019 <a href="/about">ntalbs</a></section><section class="poweredby">Powered by <a class="icon-ghost" href="https://gohugo.io">Hugo</a></section></div></footer></body></html>