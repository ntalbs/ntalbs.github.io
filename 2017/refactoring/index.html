<!doctype html><html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-2098194-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-2098194-3')</script>
<meta charset=utf-8>
<meta name=google-site-verification content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE">
<meta property="og:image" content="https://ntalbs.github.io/images/ntalbs.jpg">
<meta name=viewport content="width=device-width,initial-scale=1">
<title>리팩터링 @ntalbs' stuff</title>
<link rel="shortcut icon" href=/images/favicon.ico>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/highlight.css>
</head>
<body>
<div id=progress>
<div id=bar></div>
<div class=container>
<div id=scroll-title>리팩터링</div>
</div>
</div>
<nav class=navbar role=navigation>
<div class=container>
<div class=navbar-header>
<button type=button class="navbar-toggle unselectable" data-toggle=collapse data-target=#nav-items>+</button>
<a class="navbar-brand unselectable" href=/>@ntalbs' stuff</a>
</div>
<div class="navbar-items collapsed" id=nav-items>
<ul>
<li><a class=unselectable href=/archive/>Archive</a></li>
<li><a class=unselectable href=/tags/>Tags</a></li>
<li><a class=unselectable href=/about/>About</a></li>
<li><a id=mode-switch class=unselectable href=#></a></li>
</ul>
</div>
</div>
</nav>
<header class=page-head>
<div class=container>
<p class=blog-description>내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p>
</div>
</header>
<main class=container role=main>
<article class=post>
<header>
<p class=post-meta>
<time datetime=2017-05-01 itemprop=datePublished>2017-05-01</time>
on
<a href=/tags/java/>Java</a>
<a href=/tags/%eb%a6%ac%ed%8c%a9%ed%84%b0%eb%a7%81/>리팩터링</a>
</p>
<h1 class=post-title>
리팩터링
</h1>
</header>
<section class=post-content>
<p>API Gateway를 수정하는 작업을 하다가 다음 메서드를 보았다. 주어진 문자열에서 괄호 짝이 맞는지 확인하는 함수로 파라미터가 포함된 URI를 검증할 때 사용되고 있었다.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>static</span> <span class=kt>boolean</span> <span class=nf>isBalanced</span><span class=o>(</span><span class=n>String</span> <span class=n>testString</span><span class=o>,</span> <span class=kt>char</span> <span class=n>left</span><span class=o>,</span> <span class=kt>char</span> <span class=n>right</span><span class=o>)</span> <span class=o>{</span>
  <span class=n>Queue</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>stack</span> <span class=o>=</span> <span class=n>Collections</span><span class=o>.</span><span class=na>asLifoQueue</span><span class=o>(</span><span class=k>new</span> <span class=n>ArrayDeque</span><span class=o>&lt;&gt;());</span>
  <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>testString</span><span class=o>.</span><span class=na>length</span><span class=o>();</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>(</span><span class=n>testString</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>)</span> <span class=o>==</span> <span class=n>left</span><span class=o>)</span>  <span class=o>{</span>
      <span class=k>if</span> <span class=o>(</span><span class=n>stack</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>&gt;</span> <span class=n>0</span> <span class=o>||</span> <span class=n>testString</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span> <span class=o>+</span> <span class=n>1</span><span class=o>)</span> <span class=o>==</span> <span class=n>right</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
      <span class=o>}</span>
      <span class=n>stack</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>left</span><span class=o>);</span>
    <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>testString</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>)</span> <span class=o>==</span> <span class=n>right</span><span class=o>)</span> <span class=o>{</span>
      <span class=k>if</span> <span class=o>(</span><span class=n>stack</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>==</span> <span class=n>0</span> <span class=o>||</span> <span class=n>stack</span><span class=o>.</span><span class=na>remove</span><span class=o>()</span> <span class=o>!=</span> <span class=n>left</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
      <span class=o>}</span>
    <span class=o>}</span>
  <span class=o>}</span>
  <span class=k>return</span> <span class=n>stack</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>==</span> <span class=n>0</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></div><p>예를 들어 <code>"https://api.gw.com/${stage}/${ver}"</code>와 같은 식으로 URL이 문자열로 주어졌을 때, 다음과 같이 <code>{</code>와 <code>}</code>가 짝이 맞는지 확인할 수 있다.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>isBalanced</span><span class=o>(</span><span class=s>&#34;https://api.gw.com/${stage}/${ver}&#34;</span><span class=o>,</span> <span class=sc>&#39;{&#39;</span><span class=o>,</span> <span class=sc>&#39;}&#39;</span><span class=o>);</span>
</code></pre></div><p>코드를 읽어보면 URL 문자열은 다음 조건을 만족해야 함을 알 수 있다.</p>
<ul>
<li><code>left</code> 문자와 <code>right</code> 문자 짝이 맞아야 한다.</li>
<li><code>left</code> 문자 후 바로 <code>right</code> 문자가 나오면 안 된다. 즉 <code>{}</code>와 같이 나오면 파라미터 이름이 없는 것이므로 유효한 URL이 아니다.</li>
<li>중첩될 수 없다. 즉 <code>${param${nested}}</code>와 같은 형식은 지원하지 않는다.</li>
</ul>
<p>원래 구현에서는 스택을 사용하고 있는데 이런 간단한 작업에 굳이 스택이 필요할까 하는 생각이 들었다. <code>testString</code>을 스캔하면서 <code>left</code> 문자가 나오면 스택에 <code>left</code> 문자를 넣고 <code>right</code> 문자가 나오면 스택에 넣었던 문자를 꺼내고 있다. 스택에 넣는 문자는 항상 <code>left</code>이므로, 스택에서 꺼낸 문자가 <code>left</code>인지 비교하는 코드는 불필요하다.</p>
<p>불필요한 코드를 제거하고 스택 대신 카운터를 사용하도록 코드를 수정해봤다.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>private</span> <span class=kd>static</span> <span class=kt>boolean</span> <span class=nf>isBalanced</span><span class=o>(</span><span class=n>String</span> <span class=n>testString</span><span class=o>,</span> <span class=kt>char</span> <span class=n>left</span><span class=o>,</span> <span class=kt>char</span> <span class=n>right</span><span class=o>)</span> <span class=o>{</span>
  <span class=kt>int</span> <span class=n>level</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>
  <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>0</span><span class=o>,</span> <span class=n>len</span> <span class=o>=</span> <span class=n>testString</span><span class=o>.</span><span class=na>length</span><span class=o>();</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>len</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>(</span><span class=n>testString</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>)</span> <span class=o>==</span> <span class=n>left</span><span class=o>)</span> <span class=o>{</span>
      <span class=n>level</span><span class=o>++;</span>
      <span class=k>if</span> <span class=o>(</span><span class=n>level</span> <span class=o>&gt;</span> <span class=n>1</span> <span class=o>||</span> <span class=n>testString</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span> <span class=o>+</span> <span class=n>1</span><span class=o>)</span> <span class=o>==</span> <span class=n>right</span><span class=o>)</span> <span class=k>break</span><span class=o>;</span>
    <span class=o>}</span>
    <span class=k>if</span> <span class=o>(</span><span class=n>testString</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>)</span> <span class=o>==</span> <span class=n>right</span><span class=o>)</span> <span class=o>{</span>
      <span class=n>level</span><span class=o>--;</span>
      <span class=k>if</span> <span class=o>(</span><span class=n>level</span> <span class=o>&lt;</span> <span class=n>0</span><span class=o>)</span> <span class=k>break</span><span class=o>;</span>
    <span class=o>}</span>
  <span class=o>}</span>
  <span class=k>return</span> <span class=n>level</span> <span class=o>==</span> <span class=n>0</span>
<span class=o>}</span>
</code></pre></div><p>위 코드에서 <code>level</code>이 카운터다. <code>testString</code>을 스캔하면서 <code>left</code> 문자가 나오면 카운터를 증가시키고 <code>right</code> 문자가 나오면 카운터를 감소시킨다. 즉, 스택에 문자럴 넣고 빼는 대신 카운터를 증가시키거나 감소시키고, 스택 크기를 검사하는 대신 카운터 값을 검사하면 된다.</p>
<p>코드 길이가 눈에 띄게 줄어들지는 않았지만, 메소드를 호출할 때마다 스택을 생성하지 않게 되었다. 스택을 생성하지 않는다고 해서 성능이 얼마나 개선될지는 모르겠다. 그러나 스택을 만들지 않고도 똑같은 로직으로 문제를 해결할 수 있는데 굳이 스택을 생성할 필요는 없지 않은가.</p>
</section>
<footer class=post-footer>
<div class="social button-box">
<a href=https://twitter.com/share class=twitter-share-button data-show-count=false>Tweet</a>
<a class=twitter-follow-button href=https://twitter.com/ntalbs data-show-count=false>Follow @ntalbs</a>
<script async src=//platform.twitter.com/widgets.js></script>
</div>
<nav id=article-nav>
<a class="article-nav-link-wrap previous" href=https://ntalbs.github.io/2017/bad-luck-1/ id=article-nav-newer> 불운 1</a>
<a class="article-nav-link-wrap next" href=https://ntalbs.github.io/2017/poor-code/ id=article-nav-older> 코딩 시간과 코드 품질</a>
</nav>
</footer>
</article>
</main>
<section class=section>
<div class=container>
<aside><div id=disqus_thread></div></aside>
<script type=text/javascript>var disqus_shortname='ntalbs-stuff',permalink="https://ntalbs.github.io/2017/refactoring/".replace(/\//g,'/'),disqus_config=function(){this.page.url=permalink,this.page.identifier=permalink};(function(){var a=document,b=a.createElement('script');b.src='https://'+disqus_shortname+'.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript>
</div>
</section>
<section class=section>
<div class="container has-text-centered">
<p></p>
</div>
</section>
<script src=https://ntalbs.github.io/js/index.js type=text/javascript></script>
<script src=https://ntalbs.github.io/js/mode.js type=text/javascript></script>
<footer class=page-bottom>
<div class=inner>
<section class=copyright>© 2008-2022 <a href=/about>ntalbs</a></section>
<section class=poweredby>Powered by <a class=icon-ghost href=https://gohugo.io>Hugo</a></section>
</div>
</footer>
</body>
</html>