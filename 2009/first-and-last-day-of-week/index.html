<!doctype html><html><head><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3882204692252974" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-2098194-3"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-2098194-3")</script><meta charset=utf-8><meta name=google-site-verification content="U8HPz3to00q8wRxuKaw82QsuVvOzGyPxcWhySSYAjOE"><meta name=description content="Database.Sarang.net Q&A 게시판에 특정 주(몇월 몇째주)를 주면 이 주의 첫 날과 마지막 날을 구하는 방법에 대한 질문이 올라왔다. 열심히 머리를 굴려본 결과 해당 주에 포함된 날짜를 구하면 그 주의 첫 날과 마지막 날을 구할 수 있음을 알게 됐고, 다음과 같은 쿼리를 작성했다."><meta name=og:title content="주어진 주의 첫 날과 마지막 날 구하기 @ntalbs' stuff"><meta name=og:description content="Database.Sarang.net Q&A 게시판에 특정 주(몇월 몇째주)를 주면 이 주의 첫 날과 마지막 날을 구하는 방법에 대한 질문이 올라왔다. 열심히 머리를 굴려본 결과 해당 주에 포함된 날짜를 구하면 그 주의 첫 날과 마지막 날을 구할 수 있음을 알게 됐고, 다음과 같은 쿼리를 작성했다."><meta name=og:url content="https://ntalbs.github.io/2009/first-and-last-day-of-week/"><meta name=og:image content="https://ntalbs.github.io/images/ntalbs.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@ntalbs"><meta name=twitter:creater content="@ntalbs"><meta name=viewport content="width=device-width,initial-scale=1"><title>주어진 주의 첫 날과 마지막 날 구하기 @ntalbs' stuff</title><link rel="shortcut icon" href=/images/favicon.ico><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/highlight.css></head><body><div id=progress><div id=bar></div><div class=container><div id=scroll-title>주어진 주의 첫 날과 마지막 날 구하기</div></div></div><nav class=navbar role=navigation><div class=container><div class=navbar-header><button type=button class="navbar-toggle unselectable" data-toggle=collapse data-target=#nav-items>+</button>
<a class="navbar-brand unselectable" href=/>@ntalbs' stuff</a></div><div class="navbar-items collapsed" id=nav-items><ul><li><a class=unselectable href=/archive/>Archive</a></li><li><a class=unselectable href=/tags/>Tags</a></li><li><a class=unselectable href=/about/>About</a></li><li><a id=mode-switch class=unselectable href=#></a></li></ul></div></div></nav><header class=page-head><div class=container><p class=blog-description>내 이 세상 도처에서 쉴 곳을 찾아보았으나, 마침내 찾아낸, 컴퓨터가 있는 구석방보다 나은 곳은 없더라.</p></div></header><main class=container role=main><article class=post><header><p class=post-meta><time datetime=2009-12-03 itemprop=datePublished>2009-12-03</time>
on
<a href=/tags/db/>DB</a>
<a href=/tags/oracle/>Oracle</a>
<a href=/tags/sql/>SQL</a></p><h1 class=post-title>주어진 주의 첫 날과 마지막 날 구하기</h1></header><section class=post-content><p><a href=http://database.sarang.net/>Database.Sarang.net</a> Q&A 게시판에 특정 주(몇월 몇째주)를 주면 이 주의 첫 날과 마지막 날을 구하는 방법에 대한 질문이 올라왔다. 열심히 머리를 굴려본 결과 해당 주에 포함된 날짜를 구하면 그 주의 첫 날과 마지막 날을 구할 수 있음을 알게 됐고, 다음과 같은 쿼리를 작성했다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=n>to_date</span><span class=p>(:</span><span class=n>d</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;YYYYMMDD&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>-</span><span class=w> </span><span class=n>to_number</span><span class=p>(</span><span class=n>to_char</span><span class=p>(</span><span class=n>to_date</span><span class=p>(:</span><span class=n>d</span><span class=p>,</span><span class=s1>&#39;YYYYMMDD&#39;</span><span class=p>),</span><span class=s1>&#39;D&#39;</span><span class=p>))</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=n>start_dt</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=n>to_date</span><span class=p>(:</span><span class=n>d</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;YYYYMMDD&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=mi>7</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>to_number</span><span class=p>(</span><span class=n>to_char</span><span class=p>(</span><span class=n>to_date</span><span class=p>(:</span><span class=n>d</span><span class=p>,</span><span class=s1>&#39;YYYYMMDD&#39;</span><span class=p>),</span><span class=s1>&#39;D&#39;</span><span class=p>))))</span><span class=w> </span><span class=n>end_dt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>dual</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>그러나 이 쿼리는 주어진 주에 대한 날짜를 구하는 방법이 들어있지 않아 완전한 답이 될 수 없다. 그런데 바로 아래 어느 훌륭한 분이 완벽한 답을 달았다. 끙끙대며 열심히 이해한 결과를 설명하면... 다음과 같다. 그리고 <code>trunc</code> 함수를 쓰면 식도 훨씬 단순해짐을 알았다.</p><h2 id=1-달의-마지막-날짜-계산>1. 달의 마지막 날짜 계산</h2><p>해당 달의 마지막 날짜 구한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>last_day</span><span class=p>(</span><span class=n>to_date</span><span class=p>(:</span><span class=n>yyyymm</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;YYYYMM&#39;</span><span class=p>)</span><span class=w> </span><span class=n>day_last</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>:</span><span class=n>week</span><span class=w> </span><span class=n>week</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>dual</span><span class=w>
</span></span></span></code></pre></div><h2 id=2-달이-가진-주-수-계산>2. 달이 가진 주 수 계산</h2><p>해당 달이 몇 주를 가지는지(또는 마지막 주가 몇째 주인지) 구한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=n>trunc</span><span class=p>(</span><span class=n>day_last</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;D&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>-</span><span class=w> </span><span class=n>trunc</span><span class=p>(</span><span class=n>trunc</span><span class=p>(</span><span class=n>day_last</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;MM&#39;</span><span class=p>),</span><span class=w> </span><span class=s1>&#39;D&#39;</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>7</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>last_week</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>day_last</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>week</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h2 id=3-지정된-주-날짜-계산>3. 지정된 주 날짜 계산</h2><p>지정된 주에 포함된 날짜를 구한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>day_last</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>7</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>decode</span><span class=p>(</span><span class=n>least</span><span class=p>(</span><span class=n>last_week</span><span class=p>,</span><span class=w> </span><span class=n>week</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>week</span><span class=p>,</span><span class=w> </span><span class=n>last_week</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>week</span><span class=p>)</span><span class=w> </span><span class=n>base</span><span class=w> </span><span class=k>day</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h2 id=4-주의-첫-날과-마지막-날-계산>4. 주의 첫 날과 마지막 날 계산</h2><p>이 날짜가 포함된 주의 첫 날과 마지막 날을 구한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>trunc</span><span class=p>(</span><span class=n>base_day</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;D&#39;</span><span class=p>)</span><span class=w> </span><span class=n>start_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>trunc</span><span class=p>(</span><span class=n>base_day</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;D&#39;</span><span class=p>)</span><span class=o>+</span><span class=mi>6</span><span class=w> </span><span class=n>end_date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><p>세번째 단계에서 <code>decode(least(...))</code> 대신 <code>case when week &lt; last_week then last_week - week end</code>로 하는 게 이해하기 더 쉬울 듯 하다.</p><h2 id=통합>통합</h2><p>위 쿼리를 모두 합치면 다음과 같은 쿼리를 얻을 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>trunc</span><span class=w> </span><span class=p>(</span><span class=n>base_day</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;d&#39;</span><span class=p>)</span><span class=w> </span><span class=n>starting_day</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>trunc</span><span class=w> </span><span class=p>(</span><span class=n>base_day</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;d&#39;</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=n>ending_day</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>day_last</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>7</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=k>case</span><span class=w> </span><span class=k>when</span><span class=w> </span><span class=n>week</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>last_week</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>then</span><span class=w> </span><span class=n>last_week</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>week</span><span class=w> </span><span class=k>end</span><span class=p>)</span><span class=w> </span><span class=n>base_day</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>(</span><span class=n>trunc</span><span class=p>(</span><span class=n>day_last</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;d&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>-</span><span class=w> </span><span class=n>trunc</span><span class=p>(</span><span class=n>trunc</span><span class=p>(</span><span class=n>day_last</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;mm&#39;</span><span class=p>),</span><span class=w> </span><span class=s1>&#39;d&#39;</span><span class=p>))</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>7</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>last_week</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>day_last</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>week</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>last_day</span><span class=w> </span><span class=p>(</span><span class=n>to_date</span><span class=w> </span><span class=p>(:</span><span class=n>yyyymm</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;yyyymm&#39;</span><span class=p>))</span><span class=w> </span><span class=n>day_last</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>:</span><span class=n>week</span><span class=w> </span><span class=n>week</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>from</span><span class=w> </span><span class=n>dual</span><span class=p>)));</span><span class=w>
</span></span></span></code></pre></div><p>여기까지도 멋졌는데, 다음 쿼리를 보니... 더 멋지다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>decode</span><span class=p>(</span><span class=n>least</span><span class=p>(</span><span class=n>day_last</span><span class=p>,</span><span class=w> </span><span class=n>base_fday</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>base_fday</span><span class=p>,</span><span class=w> </span><span class=n>base_fday</span><span class=p>)</span><span class=w> </span><span class=n>start_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>decode</span><span class=p>(</span><span class=n>least</span><span class=p>(</span><span class=n>day_last</span><span class=p>,</span><span class=w> </span><span class=n>base_fday</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>base_fday</span><span class=p>,</span><span class=w> </span><span class=n>base_fday</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>6</span><span class=p>)</span><span class=w> </span><span class=n>end_date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>trunc</span><span class=p>(</span><span class=n>first_day</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>7</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>week</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=s1>&#39;d&#39;</span><span class=p>)</span><span class=w> </span><span class=n>base_fday</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>last_day</span><span class=p>(</span><span class=n>first_day</span><span class=p>)</span><span class=w> </span><span class=n>day_last</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>to_date</span><span class=p>(:</span><span class=n>yyyymm</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;yyyymm&#39;</span><span class=p>)</span><span class=w> </span><span class=n>first_day</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>:</span><span class=n>week</span><span class=w> </span><span class=n>week</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>dual</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></div></section><footer class=post-footer><div class="social button-box"><a href=https://twitter.com/share class=twitter-share-button data-show-count=false>Tweet</a>
<a class=twitter-follow-button href=https://twitter.com/ntalbs data-show-count=false>Follow @ntalbs</a>
<script async src=//platform.twitter.com/widgets.js></script></div><nav id=article-nav><a class="article-nav-link-wrap previous" href=/2010/id-1/ id=article-nav-newer>아이디 1</a>
<a class="article-nav-link-wrap next" href=/2009/canvas-test/ id=article-nav-older>Canvas 테스트</a></nav></footer></article></main><section class=section><div class=container><aside><div id=disqus_thread></div></aside><script type=text/javascript>var disqus_shortname="ntalbs-stuff",permalink="https://ntalbs.github.io/2009/first-and-last-day-of-week/".replace(/\//g,"/"),disqus_config=function(){this.page.url=permalink,this.page.identifier=permalink};(function(){var e=document,t=e.createElement("script");t.src="https://"+disqus_shortname+".disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p></p></div></section><script src=https://ntalbs.github.io/js/index.js type=text/javascript></script>
<script src=https://ntalbs.github.io/js/mode.js type=text/javascript></script><footer class=page-bottom><div class=inner><section class=copyright>© 2008-2022 <a href=/about>ntalbs</a></section><section class=poweredby>Powered by <a class=icon-ghost href=https://gohugo.io>Hugo</a></section></div></footer></body></html>